if(!Array.prototype.forEach){Array.prototype.forEach=function forEach(callback,thisArg){var T,k;if(this==null){throw new TypeError("this is null or not defined");}var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!=="[object Function]"){throw new TypeError(callback+" is not a function");}if(thisArg){T=thisArg;}k=0;while(k<len){var kValue;if(Object.prototype.hasOwnProperty.call(O,k)){kValue=O[k];callback.call(T,kValue,k,O);}k++;}};}if(!Array.prototype.every){Array.prototype.every=function(fun){if(this==null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!="function"){throw new TypeError();}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t&&!fun.call(thisp,t[i],i,t)){return false;}}return true;};}if(!Array.prototype.some){Array.prototype.some=function(fun){if(this==null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!="function"){throw new TypeError();}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t&&fun.call(thisp,t[i],i,t)){return true;
}}return false;};}if(!Array.prototype.filter){Array.prototype.filter=function(fun){if(this==null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!="function"){throw new TypeError();}var res=[];var thisp=arguments[1];for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisp,val,i,t)){res.push(val);}}}return res;};}if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined");}var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+" is not a function");}if(thisArg){T=thisArg;}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}k++;}return A;};}if("function"!==typeof Array.prototype.reduce){Array.prototype.reduce=function(callback,opt_initialValue){if(null===this||"undefined"===typeof this){throw new TypeError("Array.prototype.reduce called on null or undefined");
}if("function"!==typeof callback){throw new TypeError(callback+" is not a function");}var index=0,length=this.length>>>0,value,isValueSet=false;if(1<arguments.length){value=opt_initialValue;isValueSet=true;}for(;length>index;++index){if(!this.hasOwnProperty(index)){continue;}if(isValueSet){value=callback(value,this[index],index,this);}else{value=this[index];isValueSet=true;}}if(!isValueSet){throw new TypeError("Reduce of empty array with no initial value");}return value;};}if("function"!==typeof Array.prototype.reduceRight){Array.prototype.reduceRight=function(callback,opt_initialValue){if(null===this||"undefined"===typeof this){throw new TypeError("Array.prototype.reduceRight called on null or undefined");}if("function"!==typeof callback){throw new TypeError(callback+" is not a function");}var length=this.length>>>0,index=length-1,value,isValueSet=false;if(1<arguments.length){value=opt_initialValue;isValueSet=true;}for(;-1<index;--index){if(!this.hasOwnProperty(index)){continue;}if(isValueSet){value=callback(value,this[index],index,this);
}else{value=this[index];isValueSet=true;}}if(!isValueSet){throw new TypeError("Reduce of empty array with no initial value");}return value;};}if(typeof console==="undefined"||typeof console.log==="undefined"){var console={log:function(){}};}function debug(message){if(document.location.host.indexOf("blip")<0||window._FORCE_DEBUG_MODE){console.log(message);}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){if(this==null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(len===0){return -1;}var n=0;if(arguments.length>1){n=Number(arguments[1]);if(n!=n){n=0;}else{if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}}if(n>=len){return -1;}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}return -1;};}var BLIP={Class:{namespace:function(name,value){var parts=name.split("."),type,part,i;for(i=0;i<parts.length;i++){part=parts.slice(0,i+1).join(".");eval("type = typeof("+part+");");
if(type=="undefined"){eval(part+" = {}");}}eval(name+" = value");},create:function(name,superClass,constructor,our){var inheritence,i;BLIP.Class.namespace(name,constructor);if(superClass&&superClass!=Object&&superClass!=Function){inheritence=function(){};inheritence.prototype=superClass.prototype;constructor.prototype=new inheritence();constructor.prototype.constructor=constructor;constructor.baseConstructor=superClass;constructor.prototype.superClass=superClass;constructor.superClass=superClass.prototype;}for(i in our){constructor.prototype[i]=our[i];}return constructor;}},Mixin:{create:function(name,mixin){BLIP.Class.namespace(name,mixin);}}};BLIP.Class.create("BLIP.Object",Object,function(){},{listeners:{},getCallback:function(f){var self=this;return function(){f.apply(self,arguments);};},addEventListener:function(eventName,func,scope){$(window).bind(eventName,function(event){var args=arguments[1]?arguments[1]:{};args.originalEvent=event;if(scope){func.call(scope,args);}else{func(args);
}});},removeEventListener:function(eventName,eventListener){$(window).unbind(eventName,eventListener);return;},fireEvent:function(eventName,args){if(window.location.hash==="debug"){BLIP.Object.prototype.log(eventName,args);}args=args?[args]:[];$(window).trigger(eventName,args);return;},log:function(){try{console.log.apply(console,arguments);}catch(e){try{opera.postError.apply(opera,arguments);}catch(e2){}}},superCall:function(functionName,args){return this.superClass.prototype[functionName].call(this,args);},superConstruct:function(args){this.superClass.call(this,args);},concatArgs:function(args,dargs){var result=[],i;for(i=0;i<args.length;i++){result.push(args[i]);}for(i=1;i<dargs.length;i++){result.push(dargs[i]);}return result;},delegate:function(func){var self=this,dargs=arguments,f=function(){func.apply(self,self.concatArgs(arguments,dargs));};return f;},is:function(mixin){var thisContext=this;if(mixin===undefined){throw"Mixin is undefined! Did you forget to include it?";}if(mixin.length>0){return function(){mixin.apply(thisContext,arguments);
};}else{mixin.call(this);return this;}}});BLIP.Class.createSingleton=function(name,superClass,cons,our){var constructor=BLIP.Class.create(name,superClass,cons,our);eval(name+" = new constructor()");};BLIP.Delegate={context:{},create:function(obj,func,args){return function(){func.call(obj,args,arguments);};},createAsString:function(obj,func,args){var rand=Math.floor(Math.random()*1000000000);while(this.context[rand]){rand=Math.floor(Math.random()*1000000000);}this.context[rand]=this.create(obj,func,args);return"BLIP.Delegate.context["+rand+"]();";},createAsSimpleString:function(obj,func){var delegate=this.createAsString(obj,func);delegate.replace("();","");return delegate;}};BLIP.Class.create("BLIP.Facebook",BLIP.Object,function(config){this.appId=config.appId;this.postsId=config.postsId;this.successRedirect=config.successRedirect;this.failureRedirect=config.failureRedirect;this.watched=false;$(document).ready(this.delegate(this.init));},{permissions:"email",init:function(){window.fbAsyncInit=this.delegate(function(){var thisContext=this;
FB.Event.subscribe("auth.statusChange",this.delegate(this.on_facebookStatusChange));FB.Event.subscribe("edge.create",function(){thisContext.fireEvent("facebook.like");});FB.init({appId:this.appId,status:true,cookie:true,xfbml:true,oauth:true,channelURL:$("meta[name=fb_channel_url]").attr("value")});this.ready=true;this.fireEvent("FacebookReady");});if(!$("#fb-root").length){$(document.body).append($('<div id="fb-root"></div>'));}var fbScript=document.createElement("script");fbScript.async=true;fbScript.src="//connect.facebook.net/en_US/all.js";$("#fb-root").append(fbScript);},on_facebookLogin:function(response){debug("logged in:");debug(response);this.sendAuthResponse(response.authResponse);FB.api("/me",this.delegate(function(response){this.me=response;}));this.status=response.status;},on_facebookLogout:function(){},on_facebookStatusChange:function(response,force){if(response.status==="not_authorized"){if(!session){this.fireEvent("facebook.not_authorized");}else{$.get("/facebook/logout?no-cache=1",function(){BLIP.Object.prototype.fireEvent("facebook.not_authorized");
});}}this.status=response.status;},login:function(callback){var thisContext=this;FB.login(function(response){if(response.status==="unknown"){thisContext.fireEvent("viewer.loginfail");}thisContext.on_facebookLogin(response);if(callback&&typeof callback==="function"){callback(response);}},{scope:thisContext.permissions});this.fireEvent("viewer.loginAttempt","website");},logout:function(){var thisContext=this;$.get("/facebook/logout?no-cache=1",function(){thisContext.fireEvent("viewer.logout");});},sendAuthResponse:function(authResponse,callback,forceIt){var json=JSON.stringify(authResponse),vSession=BLIP.Utils.getCookie("v_session");if(vSession&&vSession!=="LOGGEDOUT"&&!forceIt){this.fireEvent("viewer.login");return;}$.post("/facebook/verify_viewer_user",{authResponse:json,skin:"json","no-cache":1,no_wrap:1},this.delegate(function(response){this.sendAuthResponseResponded(response);if(callback){callback(response);}}),"json");},sendAuthResponseResponded:function(response){this.log("verify_viewer_user response: "+response.error);
if(response.error===0){this.fireEvent("viewer.login",{isNewUser:response.new_user});if(response.new_user){this.fireEvent("viewer.newViewerSignup");}else{this.fireEvent("viewer.existingViewerLogin");}$.getJSON("/subscriptions/has_subscription?no_wrap=true",function(result){try{if(result.error===0&&parseInt(result.has_subscription,10)){BLIP.Utils.setCookie({name:"viewer_status",value:"subscriber"});}else{if(!result.error){BLIP.Utils.setCookie({name:"viewer_status",value:"non-subscriber"});}else{if(result.error){BLIP.Utils.deleteCookie("v_session");}}}}catch(x){}});}else{if($('meta[property="fb:app_id"]').attr("content")!==""){BLIP.Page.shareNotice({text:"Oops! We done goofed. Please try again later."});}}},sendWatch:function(){$.post("/facebook/watch",{posts_id:this.postsId,skin:"json","no-cache":1,no_wrap:1},this.delegate(this.sendWatchResponded),"json");},sendWatchResponded:function(response){this.fireEvent("viewer.watched");},hasSocialBroadcastPermission:function(){return !!$("#SharingStatus").attr("checked");
},hasSendWatchPermission:function(){return this.hasSocialBroadcastPermission()&&$("#SendWatches").attr("checked");},hasSendFollowPermission:function(){return this.hasSocialBroadcastPermission()&&$("#SendFollows").attr("checked");},hasSendLovePermission:function(){return this.hasSocialBroadcastPermission()&&$("#SendLoves").attr("checked");},hasPostOnTimelinePermission:function(callback){FB.api("/me/permissions",function(response){if(response&&response.data&&response.data[0]){callback(!!response.data[0].publish_actions);}else{callback(false);}});}});BLIP.Class.create("BLIP.MyblipNotificationMonitor",BLIP.Object,function(){this.registerEvents();},{registerEvents:function(){var updateDelegate=this.delegate(this.getNotificationCount);this.addEventListener("series.follow",updateDelegate);this.addEventListener("series.unfollow",updateDelegate);this.addEventListener("episode.exclude",updateDelegate);this.addEventListener("episode.watch",updateDelegate);},getNotificationCount:function(){var thisContext=this;
$.post("/viewers/masthead_menu?no_wrap=1&no-cache=1",function(response){var viewerMenu=$(response);if(viewerMenu.find(".NotificationCount").html().trim()!==""){thisContext.sendNotificationCount(parseInt(viewerMenu.find(".NotificationCount").html(),10));}});},sendNotificationCount:function(count){this.fireEvent("viewer.notificationsUpdated",count);}});BLIP.Class.createSingleton("BLIP.Page",BLIP.Object,function(){var thisContext=this;this.contentHolders={};this.currentContent={};this.originalState={};$(document).ready(function(){thisContext.on_documentReady();});},{lastClickPosition:[],on_documentReady:function(){try{document.domain=window.location.hostname;}catch(x){}if(window._gaq&&_Analytics){_Analytics.detectSubscriberStatus();}_Analytics.setVariables();this.initContent();this.initEvents();this.initImages();this.initIeMessage();this.initFacebookMouseTracking();if($.browser.mozilla&&$.browser.version.indexOf("1.9")>=0){this.initFirefoxScrollbarFix();}this.currentBracket=this.getWindowSizeBracket();
$("body").attr("data-responsive",this.currentBracket);this.fireEvent("WindowBracketChange",{from:this.currentBracket,to:this.currentBracket});this.fireEvent("page.load");if(BLIP.Utils.getCookie("v_session")&&BLIP.Utils.getCookie("v_session")!=="LOGGEDOUT"){this.currentViewer=new BLIP.Model.Viewer();this.currentViewer.refresh();}this.addEventListener("viewer.login",this.delegate(function(){this.currentViewer=new BLIP.Model.Viewer();this.currentViewer.refresh();}));this.applyComscore();$("#Content").delegate("[data-placement] a","click",function(evt){evt.preventDefault();BLIP.Page.fireEvent("contentlink.click",{link:$(this),originalEvent:evt});});},initContent:function(){if(BLIP.MyblipNotificationMonitor){this.myblipMonitor=new BLIP.MyblipNotificationMonitor();}if(BLIP.Unit.Header){this.header=new BLIP.Unit.Header({domRoot:$("#Header")});}if(BLIP.Unit.Footer){this.footer=new BLIP.Unit.Footer({domRoot:$("#Footer")});}if(BLIP.Unit.Modal&&BLIP.Unit.Modal.FacebookConnect){this.facebookConnectModal=new BLIP.Unit.Modal.FacebookConnect({domRoot:$("<a></a>"),contentRoot:$("#SubscribeLoginModal")});
}this.facebook=new BLIP.Facebook({appId:$('meta[property="fb:app_id"]').attr("content"),postsId:$("#PageInfo").attr("data-posts-id"),failureRedirect:"/subscriptions/start-subscribing"});this.addEventListener("FacebookReady",this.delegate(this.onFacebookReady));this.registerDefaultContent();if($.smartbanner){this.initSmartBannerJquery();}},initEvents:function(){var thisContext=this,newBracket;this.currentBracket=this.getWindowSizeBracket();$(window).resize(this.delegate(function(){newBracket=thisContext.getWindowSizeBracket();if(newBracket!==thisContext.currentBracket){thisContext.fireEvent("WindowBracketChange",{from:thisContext.currentBracket,to:newBracket});thisContext.currentBracket=newBracket;$("body").attr("data-responsive",newBracket);}}));},initSmartBannerJquery:function(){$.smartbanner({title:"Blip TV",author:"Blip",price:"Free",inAppStore:"In the App Store",inGooglePlay:"In Google Play",icon:null,iconGloss:null,button:"VIEW",scale:1,speedIn:300,speedOut:400,daysHidden:3,daysReminder:3,force:null});
},getWindowSizeBracket:function(){var windowWidth=$(window).width(),layouts=[961,960,940,862,768,600,480,320],i=0;for(i=layouts.length-1;i>=0;i--){if(windowWidth<=layouts[i]){return layouts[i];}}return layouts[0];},queueFacebookLogin:function(callbacks){this.facebookLoginQueued=callbacks;},onFacebookReady:function(){var thisContext=this;this.facebookReady=true;if(this.facebookLoginQueued){this.facebook.login(this.facebookLoginQueued);}FB.Event.subscribe("logout",function(){console.log(arguments);});},initFacebookMouseTracking:function(){var thisContext=this;$("div.FacebookLikeBox").live("mouseover",function(event){$(".FacebookLikeBox").attr("data-active-like-box","");$(this).attr("data-active-like-box","1");});},onFacebookLike_analytics:function(){var action=$(".FacebookLikeBox[data-active-like-box=1]").attr("data-action");_Analytics.trackEvent("facebook-like",action);},hasFacebookCookie:function(){return document.cookie.indexOf("v_session=")>=0;},hasFacebookLoggedInCookie:function(){var myCookie=BLIP.Utils.getCookie("v_session");
if(myCookie&&myCookie!==null&&myCookie!=="LOGGEDOUT"){return true;}return false;},hasFacebookLoggedOutCookie:function(){var myCookie=BLIP.Utils.getCookie("v_session");if(myCookie&&myCookie!==null&&myCookie==="LOGGEDOUT"){return true;}return false;},initFirefoxScrollbarFix:function(){$(document.body).css("overflow-x","hidden");},initImages:function(){$("img[data-src]").each(function(index,element){element.src=element.getAttribute("data-src");element.removeAttribute("data-src");});},initIeMessage:function(){var msg;if($("#UnsupportedBrowser").length){msg=$('<div id="SwitchBrowsersMessage"></div>');msg.html('For a superior experience, Blip recommends that you upgrade your browser to <a href="http://www.google.com/chrome/">Google Chrome</a> or install <a href="http://www.google.com/chromeframe">Chrome Frame</a>.');$("#Header").after(msg);}},registerFacebookLike:function(likeButton){_Analytics.trackEvent("facebook-like",likeButton.action);},registerDefaultContent:function(){var contentToLoad=document.getElementById("Content")&&document.getElementById("Content").className;
if(BLIP.Unit.Content[contentToLoad]){this.currentContent=new BLIP.Unit.Content[contentToLoad]();if(BLIP.Unit.DeferredImage){try{this.currentContent.initSubUnit(BLIP.Unit.DeferredImage);}catch(e){}}}},shareNotice:function(options){var id=options.id,text=options.text,notice=$("#ShareNotice").length?$("#ShareNotice"):$('<div id="ShareNotice">'+'<i class="BroadcastIcon">a</i>'+'<span class="Notice">'+'<span class="Content">'+'<span class="Text"></span> '+'<a class="RemoveAction">Don\'t share this</a>'+" </span>"+'<i class="Close">x</i>'+"</span>"+"</div>"),fadeTimeout,on_closeClick=function(){clearTimeout(fadeTimeout);notice.fadeOut();},on_removeClick=function(){$.post("/viewers/delete_fb_watch/"+id+"?no_wrap=1",on_closeClick,"json");};if(!$("#ShareNotice").length){$(document.body).append(notice);}notice.find(".Close").unbind("click").bind("click",on_closeClick);if(id){notice.find(".RemoveAction").unbind("click").bind("click",on_removeClick).show();}else{notice.find(".RemoveAction").hide();
}if(options&&options.error){notice.addClass("Error");}else{notice.removeClass("Error");}notice.find(".Text").html(text);notice.fadeIn();fadeTimeout=setTimeout(function(){notice.fadeOut();},options&&options.error?15000:15000);},applyComscore:function(){var c={c1:"2",c2:"6708843",c5:this.mapCategoryToComscoreCategory()};if(typeof window.COMSCORE!=="undefined"){COMSCORE.beacon(c);}_comscore.push(c);},mapCategoryToComscoreCategory:function(){var map={"Comedy":["Animation & Comics","Comedy"],"Entertainment":["Drama","Entertainment","Music"],"Lifestyle":["Fashion & Beauty","Food & Drink","Health & Fitness","Home & Family","How To","Learning","Religion","Foreign","Lifestyle"],"News & Sports":["News & Politics","Sports & Cars","Talk & Interview"],"Technology":["Tech & Gadgets"],"Videogames":["Videogames"]},categories=$("#PageInfo").data("channels-list"),category;if(!categories||categories.length===0){return"";}categories=categories.split(",");category=categories[Math.floor(Math.random()*categories.length)];
for(var superCategory in map){if(map[superCategory].some(function(cat){return cat===category;})){debug("category chosen: "+superCategory);return superCategory;}}return"categoryDefault";}});BLIP.Utils={errorArray:[],myModal:null,onPlayerReady:function(playerObject,readyCallback){var limit=5000,i=0,interval;interval=setInterval(function(){var el=document.getElementById(playerObject.id);if(el.addJScallback){clearInterval(interval);readyCallback();}i++;if(i>limit){clearInterval(interval);}},33);},getCookie:function(cookieName){var c_name=cookieName,c_start=document.cookie.indexOf(c_name+"=");if(c_start!==-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end===-1){c_end=document.cookie.length;}return unescape(document.cookie.substring(c_start,c_end));}return null;},setCookie:function(config){var defaults={name:null,value:null,expire:null,path:"/"},date=new Date();$.extend(defaults,config);if(defaults.expire!==null&&defaults.expire.constructor!==Date){throw new TypeError(["Date expected, ",typeof defaults.expire," encountered with constructor ",defaults.expire.constructor].join(""));
}else{if(defaults.expire===null){date.setTime(date.getTime()+31536000000);defaults.expire=date.toGMTString();}}document.cookie=[defaults.name,"=",defaults.value,"; expires=",defaults.expire,"; path=",defaults.path].join("");},deleteCookie:function(cookieName,cookiePath){var config={name:cookieName,expire:new Date(),path:cookiePath||null};config.expire.setDate(config.expire.getDate()-1);this.setCookie(config);},getCacheKiller:function(){var c_value=this.getCookie("cache_killer");if(c_value===null){c_value=0;}return c_value;},clearAllErrors:function(){var item;for(item in this.errorArray){if(!this.errorArray.hasOwnProperty(item)){continue;}this.errorArray[item].destroy();}},dateToMySqlDays:function(date){var year,month,day,utcDays;if(typeof(date)==="string"){date=Date.parse(date);}if(!date){return;}year=date.getFullYear();month=date.getMonth();day=date.getDate();utcDays=Date.UTC(year,month,day)/(86400*1000);utcDays+=719528;return utcDays;},escapeHtml:function(html){return html.replace(/&/gmi,"&amp;").replace(/\"/gmi,"&quot;").replace(/>/gmi,"&gt;").replace(/</gmi,"&lt;");
},escapeDoubleQuotes:function(str){if(str&&typeof(str)==="string"){return str.replace(/\"/g,"&#34;");}},LocalEvent:function(name,defaultContext){var stopped=false;this.listeners=[];this.name=name;this.addListener=function(fn,scope){this.listeners.push({fn:fn,scope:scope});};this.removeListeners=function(){this.listeners=[];};this.removeListener=function(fn){this.listeners=this.listeners.filter(function(listener){return listener.fn!==fn;});};this.fire=function(data){var i,stopped;for(i=0,l=this.listeners.length;i<l;i++){if(!stopped){listener=this.listeners[i];listener.fn.call(listener.scope||defaultContext||null,{name:name,event:this,data:data});}}stopped=false;};this.stop=function(){stopped=true;};return this;},formatNumber:function(nStr,prefix){var x,x1,x2,rgx;prefix=prefix||"";nStr+="";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,"$1"+","+"$2");}return prefix+x1+x2;},getError:function(div){if(this.errorArray[div]){return this.errorArray[div];
}},getLoadFailureHTML:function(){var failControl=$('<div class="FailControl">'),failMessage=$('<div class="FailMessage">');failMessage.append($('<img src="/skin/mercury/dashboard/images/dashboard.error.gif">')).append("There was a problem loading this dashboard component.");failControl.append(failMessage);return failControl;},getProperFilename:function(name,chars){var size=chars?chars:31,lastSlash,lastDot,filename,format,shortFilename;if(!name){return false;}lastSlash=name.lastIndexOf("/");lastDot=name.lastIndexOf(".");filename=name.substring(lastSlash+1,lastDot);format=name.substring(lastDot,name.length);shortFilename=BLIP.Utils.truncate(filename,size)+format.toUpperCase();return shortFilename;},hideError:function(div){if(this.errorArray[div]){this.errorArray[div].hide();}},iterate:function(collection,func,callback,context){var len,current,iter;if(!collection.length){throw new TypeError();}len=collection.length;current=0;iter=function(){if(current<len){func.call(context,collection[current],current,collection);
current++;setTimeout(iter,0);}else{callback.call(context);}};setTimeout(iter,0);},mySqlDaysToDate:function(days){var date,unixTime,year,month,day;if(days===""||parseInt(days,10)<0){return;}date=new Date();unixTime=(days-719528)*86400*1000;date.setTime(unixTime);year=date.getUTCFullYear();month=date.getUTCMonth();day=date.getUTCDate();return new Date(year,month,day);},scrollToError:function(params){var div=params.div;this.errorArray[div].scrollToError();},showError:function(params){var div=params.div,msg=params.msg,small=params.small||false;if(this.errorArray[div]===undefined){this.errorArray[div]=new BLIP.Controls.Error({target:div,message:msg,small:small});}this.errorArray[div].show();},showHelpfulError:function(params){var div=params.div,msg=params.msg,small=params.small||false;title=params.title;if(!this.errorArray[div]){this.errorArray[div]=new BLIP.Controls.Help({target:div,message:msg,small:small,title:title});}$(".HelpfulErrorBox").hide();this.errorArray[div].show();},showModalHelpText:function(params){var name=params.name,src=params.src,modal=new BLIP.Controls.ModalWindow({target:"",contentsUrl:src,purpose:"Help",name:name});
modal.show();},standardDateFormat:function(d){var months;if(d.constructor!==Date){throw new TypeError("Date expected, "+typeof d+" encountered with constructor "+d.constructor);}months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return[months[d.getMonth()]," ",d.getDate(),", ",d.getFullYear()].join("");},graphDateFormat:function(d){var months;if(d.constructor!==Date){throw new TypeError("Date expected, "+typeof d+" encountered with constructor "+d.constructor);}months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return[d.getDate(),months[d.getMonth()],d.getFullYear()].join("-");},monthDateFormat:function(d){var months;if(d.constructor!==Date){throw new TypeError("Date expected, "+typeof d+" encountered with constructor "+d.constructor);}months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return[months[d.getMonth()],d.getFullYear()].join(" ");},trimDelegate:function(str){return str.substring(0,str.length-3);
},trim:function(str){if(str===null||str===undefined){return"";}return str.replace(/^\s+|\s+$/g,"");},truncate:function(str,max){str=this.trim(str);if(str&&str.length>max){return str.substring(0,(max-2))+"&hellip;";}return str;},updateCacheKiller:function(cookie_domain){var domain_str="",exdate,expiredays,cache_killer;if(cookie_domain&&cookie_domain!==""){domain_str=";domain="+cookie_domain;}exdate=new Date();expiredays=30;exdate.setDate(exdate.getDate()+expiredays);cache_killer="cache_killer="+escape(Math.floor(Math.random()*1000000000))+";expires="+exdate.toGMTString()+";path=/"+domain_str;document.cookie=cache_killer;},uncheckAll:function(target){$("#"+target+" input:checked").attr("checked",false);$("#"+target+" input:selected").attr("selected",false);},wrapHtmlTag:function(params){var idHtml=params.elementId?" id='"+params.elementId+"'":"",classHtml=params.elementClass?" class='"+params.elementClass+"'":"",inputNameHtml=params.elementName?" name='"+params.elementName+"'":"",inputValueHtml=params.elementValue?" value='"+params.elementValue+"'":"",onClickHtml=params.onClick?" onClick='"+params.onClick+"'":"",onChangeHtml=params.onChange?' onChange="'+params.onChange+'"':"",selectedHtml=params.elementSelected?" selected":"",forHtml=params.forHtml?" for='"+params.forHtml+"'":"",maxlengthHtml=params.maxlength?" maxlength='"+params.maxlength+"'":"",disabled=params.disabled?" disabled='"+params.disabled+"'":"",attributesHtml=idHtml+classHtml+inputNameHtml+inputValueHtml+onClickHtml+onChangeHtml+disabled+maxlengthHtml+selectedHtml+forHtml,html="<"+params.tag+attributesHtml+">";
html+=params.contents;html+="</"+params.tag+">";return html;},wrapInFormTag:function(divTarget,htmlClass,i){var formElement=document.createElement("form");formElement.setAttribute("enctype","multipart/form-data");formElement.setAttribute("encoding","multipart/form-data");formElement.setAttribute("id","form"+i);if(htmlClass!==undefined){formElement.setAttribute("class",htmlClass);}$(divTarget).wrap(formElement);},createUrlParams:function(params){var paramPairs=[],returnString="",i;for(i in params){if(!params.hasOwnProperty(i)){continue;}paramPairs.push(params[i].join("="));}returnString+=paramPairs.join("&");return returnString;},UrlBuilder:function(url){var paramObjs={},base="",queryString="",splitUrl,strParams,i,paramSplit;this.addParam=function(param,value){paramObjs[param]=value;return this;};this.removeParam=function(param){delete paramObjs[param];return this;};this.getValue=function(param){return paramObjs[param];};this.getParams=function(){return paramObjs;};this.getFullUrl=function(){return[base,buildParamString()].join("?");
};function buildParamString(){var paramStrings=[],param;for(param in paramObjs){paramStrings.push([param,paramObjs[param]].join("="));}return paramStrings.join("&");}splitUrl=url.split("?");base=splitUrl[0];queryString=splitUrl[1]?splitUrl[1]:"";if(queryString!==""){strParams=queryString.split("&");for(i=0;i<strParams.length;i++){paramSplit=strParams[i].split("=");this.addParam(paramSplit[0],paramSplit[1]);}}return this;},secondsToTimeCode:function(seconds){var hours=Math.floor(seconds/(60*60)),minutes,format=function(num){return num<10?"0"+num.toString(10):num.toString(10);};seconds=seconds-(hours*60*60);minutes=Math.floor(seconds/60);seconds=seconds-(minutes*60);return[format(hours),format(minutes),format(seconds)].join(":");},timeCodeToSeconds:function(timecode){var split=timecode.split(":"),massaged="",i=0,l=split.length,date;for(;i<l;i++){split[i]=split[i].length<2?"0"+split[i]:split[i];}while(split.length<3){split.unshift("00");}massaged=split.join(":");date=Date.parse(massaged);return date.getHours()*60*60+date.getMinutes()*60+date.getSeconds();
},buildTrackedUrl:function(anchor,source,medium,content,campaign){var url=new BLIP.Utils.UrlBuilder(anchor.attr("href"));url.addParam("utm_source",source);url.addParam("utm_medium",medium);url.addParam("utm_content",content);url.addParam("utm_campaign",campaign);anchor.attr(url.getFullUrl());},areCoordsWithinBox:function(coords,boxCoords,dimensions){return(coords[0]>=boxCoords[0]&&coords[1]>=boxCoords[1]&&coords[0]<=dimensions[0]+boxCoords[0]&&coords[1]<=dimensions[1]+boxCoords[1]);},upgradeToRetina:function(elm){var cssSyntax=/^url\(['"]?|['"]?\)$/gi,poster={},isImg=false,url,backgroundSize,newSource,i,ref;if(window.devicePixelRatio<=1||typeof window.devicePixelRation==="undefined"){return;}for(i=0;i<elm.length;i++){isImg=elm[i].tagName.search(/^img$/i)!==-1;ref=$(elm[i]);if(ref.data("retina-upgraded")){return;}if(isImg){url=this.UrlBuilder(ref.attr("src"));poster.width=ref.width();poster.height=ref.height();}else{url=this.UrlBuilder(ref.css("background-image").replace(cssSyntax,""));poster.width=parseInt(url.getValue("w"),10);
poster.height=parseInt(url.getValue("h"),10);}newSource=url.addParam("w",poster.width*2).addParam("h",poster.height*2).getFullUrl();if(isImg){ref.width(poster.width);ref.height(poster.height);ref.attr("src",newSource);}else{backgroundSize=[poster.width,"px ",poster.height,"px"].join("");ref.css({"background-image":["url(",newSource,")"].join(""),"-webkit-background-size":backgroundSize,"-moz-background-size":backgroundSize,"background-size":backgroundSize});}ref.data("retina-upgraded",true);}},escapeHTML:function(str){var chars={"<":"lt",">":"gt",'"':"quot","&":"amp","'":"apos"};if(str!==null){return str.replace(/[&<>\"']/g,function(part){return"&"+chars[part]+";";});}return str;},findByData:function(dom,selector,key,value){return dom.find(selector+"[data-"+key+'="'+value+'"]');}};BLIP.Class.create("BLIP.Unit",BLIP.Object,function(config){var thisContext=this;config=config||{};if(!config.domRoot&&!this.domRoot){throw new TypeError("Invalid DOM element supplied as domRoot");}this.config=config;
BLIP.Object.call(this,config);this.domRoot=!this.domRoot&&config.domRoot?config.domRoot:this.domRoot;this.unitCollection={};this.stateChanged=new BLIP.Utils.LocalEvent("StateChange");$(document).ready(function(){if(thisContext.init){thisContext.init();}});},{initSubUnit:function(UnitConstructor,config){var thisContext=this,unitConfiguration=config||{},unitCollection=new BLIP.UnitCollection();this.domRoot.find(this.getSelectorFor(UnitConstructor)).each(function(i,el){unitConfiguration.domRoot=$(el);var unit=new UnitConstructor(unitConfiguration);thisContext.addSubUnitEventListeners(unit);unitCollection.push(unit);});this.unitCollection=unitCollection;return unitCollection;},initSingleSubUnit:function(UnitConstructor,domRoot){return new UnitConstructor({domRoot:domRoot});},addSubUnitEventListeners:function(unit){unit.stateChanged.addListener(this.childUnit_onStateChange,this);},initAdditionalSubUnits:function(collection,UnitConstructor,config){var newCollection,thisContext=this;if(collection.constructor!==BLIP.UnitCollection){newCollection=new BLIP.UnitCollection();
newCollection.push(collection);}else{newCollection=collection;}$(this.domRoot).find(this.getSelectorFor(UnitConstructor)).each(function(i,el){var found=false,unit;newCollection.each(function(unit){if(unit.domRoot[0]===el){found=true;}});if(!found){unit=new UnitConstructor({domRoot:$(el)});thisContext.addSubUnitEventListeners(unit);newCollection.push(unit);unit.init();}});return newCollection;},setContent:function(content){if(this.domRoot!==content){var parent=this.domRoot.parent();this.domRoot.replaceWith(content);this.domRoot=parent.find(this.selector);this.initContents();}},initContents:function(){},childUnit_onStateChange:function(){this.stateChanged.fire();},getState:function(){return{};},setState:function(state){return{};},getSelectorFor:function(unit){if(unit){return unit.prototype.selector;}else{throw new TypeError("No such unit. Perhaps you misspelled it, or forgot to include it?");}},getAnalyticsContext:function(startNode){startNode=startNode?startNode:this.domRoot;return startNode.attr("data-analytics-context")?startNode.attr("data-analytics-context"):startNode.parents("[data-analytics-context]").first().attr("data-analytics-context");
},selector:""});BLIP.Class.create("BLIP.UnitCollection",BLIP.Object,function(unitArray){this.units=[];if(unitArray&&unitArray.length>0){this.units=unitArray;}else{if(unitArray){this.units.push(unitArray);}}},{each:function(fn){for(var i=0,len=this.units.length;i<len;i++){fn(this.units[i]);}},push:function(unit){if(unit){this.units.push(unit);}},length:function(){return this.units.length;},getSingleState:function(i){i=i||0;return this.units[i].getState();},getMultipleStates:function(){var state=[],i;for(i=0,len=this.units.length;i<len;i++){state.push(this.getSingleState(i));}return state;},getState:function(){var state;if(this.units.length===1){state=this.getSingleState();}else{state=this.getMultipleStates();}return state;},setIdenticalStateOnAllUnits:function(state){for(var i=0,len=this.units.length;i<len;i++){this.units[i].setState(state);}},setMultipleStatesOnMultipleUnits:function(states){if(states.length!==this.units.length){throw new TypeError("Wrong number of states to set on collected units");
}for(var i=0,len=states.length;i<len;i++){this.units[i].setState(states[i]);}},setState:function(state){if(state.constructor===Array){this.setMultipleStatesOnMultipleUnits(state);}else{this.setIdenticalStateOnAllUnits(state);}},single:function(n){n=n||0;return this.units[n];}});BLIP.Class.create("BLIP.Model",BLIP.Object,function(){},{buildFromDomElement:function(element){var data=$(element).data(),property;for(property in data){if(data.hasOwnProperty(property)){this.set(property,data[property]);}}return this;},save:function(){},refresh:function(){var thisContext=this;$.getJSON(this.buildUri(),this.delegate(this.onRefreshResponse));},onRefreshResponse:function(data){var property;for(property in data){this.set(property,data[property]);}this.ready();},get:function(property){var params=Array.prototype.slice.call(arguments,0);params.shift();if(typeof this["get_"+property]==="function"){return this["get_"+property].apply(this,params);}else{return this.data[property];}},set:function(property,value){var params=[value];
if(arguments.length>=3){params=Array.prototype.slice.call(arguments,0);params.shift();}if(!this.data){this.data={};}if(typeof this["set_"+property]==="function"){this["set_"+property].apply(this,params);}else{this.data[property]=value;}}});BLIP.Class.create("BLIP.Model.Viewer",BLIP.Model,function(){},{uri:"/viewers/current?no_wrap=1",loadingFollowFor:{},buildUri:function(){var showId=$("#PageInfo").data("users-id"),episodeId=$("#PageInfo").data("posts-id");return[this.uri,"&episode_id=",episodeId?episodeId:"","&show_id=",showId?showId:""].join("");},ready:function(){debug("viewer.dataready");this.is_ready=true;this.fireEvent("viewer.dataready",this.data);},onRefreshResponse:function(response){debug("viewer data refresh:");debug(response);if(response.error){this.fireEvent("facebook.loginfail");BLIP.Page.facebook.logout();}BLIP.Model.prototype.onRefreshResponse.call(this,response);},refreshFollowStatusForShowId:function(showId,callback){var thisContext=this;if(!this.data.following){this.data.following={};
}if(this.loadingFollowFor[showId]||typeof this.data.following[showId]!=="undefined"){return;}this.loadingFollowFor[showId]=true;$.getJSON("/viewers/get_user_events/"+showId+"?no_wrap=1&no-cache=1",function(response){thisContext.set("following",showId,!!response.following);debug("Got user events for show#"+showId+":");debug(response);callback(response);thisContext.loadingFollowFor[showId]=false;});},set_follow_show_count:function(count){this.data.follow_show_count=parseInt(count,10);},set_love_count:function(count){this.data.love_count=parseInt(count,10);},set_send_loves:function(send_loves){this.data.send_loves=!!parseInt(send_loves,10);},set_send_show_follows:function(send_show_follows){this.data.send_show_follows=!!parseInt(send_show_follows,10);},set_send_social:function(send_social){this.data.send_social=!!parseInt(send_social,10);},set_send_watches:function(send_watches){this.data.send_watches=!!parseInt(send_watches,10);},set_watch_later_count:function(watch_later_count){this.data.watch_later_count=parseInt(watch_later_count,10);
},set_following:function(showId,isFollowing){showId=parseInt(showId,10);if(!this.data.following){this.data.following={};}if(typeof isFollowing==="undefined"){if(showId===0){this.data.following[parseInt($("#PageInfo").data("users-id"),10)]=false;}else{this.data.following[showId]=true;}}else{this.data.following[showId]=isFollowing;}},get_following:function(showId){showId=parseInt(showId,10);if(!this.data){this.data={};}if(this.data.following){return this.data.following[showId];}else{return this.data.following;}}});BLIP.Class.create("BLIP.Unit.FacebookConnectButton",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".FacebookLogin",prefix:"masthead",init:function(){this.preparedNewViewerCallback=this.delegate(this.on_newViewerSignup);this.preparedExistingViewerCallback=this.delegate(this.on_existingViewerSignIn);this.domRoot.delegate(".FacebookLoginButton","click",this.delegate(function(){if(this.domRoot.hasClass("Loading")){return;}_Analytics.trackEvent(_Analytics.categories.callToAction,_Analytics.prefix(this.prefix,_Analytics.actions.connect));
this.initEvents();this.domRoot.addClass("Loading");BLIP.Page.facebook.login();}));},initEvents:function(){var thisContext=this;this.addEventListener("viewer.newViewerSignup",this.preparedNewViewerCallback);this.addEventListener("viewer.existingViewerLogin",this.preparedExistingViewerCallback);this.addEventListener("viewer.loginfail",function(){thisContext.domRoot.removeClass("Loading");});},clearEvents:function(){this.removeEventListener("viewer.newViewerSignup",this.preparedNewViewerCallback);this.removeEventListener("viewer.existingViewerLogin",this.preparedExistingViewerCallback);},on_newViewerSignup:function(){_Analytics.trackEvent(_Analytics.categories.callToAction,_Analytics.prefix(this.prefix,_Analytics.actions.newLogin));this.domRoot.removeClass("Loading");this.domRoot.addClass("LoggedIn");this.clearEvents();},on_existingViewerSignIn:function(){_Analytics.trackEvent(_Analytics.categories.callToAction,_Analytics.prefix(this.prefix,_Analytics.actions.existingLogin));this.domRoot.removeClass("Loading");
this.domRoot.addClass("LoggedIn");this.clearEvents();}});BLIP.Class.create("BLIP.Unit.DropDown",BLIP.Unit,function(config){this.captionSelector=config.captionSelector||".CurrentlySelected";BLIP.Unit.call(this,config);},{selector:".DropDown",selectedItem:null,init:function(){this.onItemSelected=new BLIP.Utils.LocalEvent("ItemSelected");this.initEvents();},initEvents:function(){this.domRoot.find(this.captionSelector).bind("click",this.delegate(this.on_captionClicked));this.domRoot.find(".DropDownItem").bind("click",this.delegate(this.on_itemClicked));$(document.body).bind("click",this.delegate(this.on_documentClicked));},on_itemClicked:function(event){this.setSelected(event.target);this.item=true;return false;},on_captionClicked:function(event){if(this.isOpen()){this.closeDropDown();}else{this.openDropDown();}event.stopPropagation();},on_documentClicked:function(event){if(this.isOpen()){this.closeDropDown();}},isOpen:function(){return this.domRoot.hasClass("Open");},openDropDown:function(){this.domRoot.addClass("Open");
},closeDropDown:function(){this.domRoot.removeClass("Open");},setSelected:function(item){this.setCaption(item.innerHTML);this.selectedItem=item;this.onItemSelected.fire(item);},setCaption:function(caption){this.domRoot.find(".CurrentlySelected .Caption").html(caption);}});BLIP.Class.create("BLIP.Unit.DropDown.HoverDropDown",BLIP.Unit.DropDown,function(config){this.onOver=config.onOver;BLIP.Unit.DropDown.call(this,config);},{selector:".HoverDropDown",mouseOutTimeout:null,init:function(){this.initEvents();},initEvents:function(){this.domRoot.hover(this.delegate(this.on_captionOver),this.delegate(this.on_captionOut));},on_captionOver:function(){if(this.onOver){this.onOver();}clearTimeout(this.mouseOutTimeout);if(!this.domRoot.hasClass("Open")){this.openDropDown();}},on_captionOut:function(){var thisContext=this;this.mouseOutTimeout=setTimeout(function(){thisContext.closeDropDown();},500);}});BLIP.Class.create("BLIP.Unit.DropDown.HoverDropDown.UserMenu",BLIP.Unit.DropDown.HoverDropDown,function(config){BLIP.Unit.DropDown.HoverDropDown.call(this,config);
},{init:function(){this.initSubUnit(BLIP.Unit.SocialSettings);BLIP.Unit.DropDown.HoverDropDown.prototype.init.call(this);}});BLIP.Class.create("BLIP.Unit.AjaxCheckbox",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".AjaxCheckbox",classes:{off:"Off",on:"On",loading:"Loading"},init:function(){this.uri=this.domRoot.attr("data-uri");this.token=this.domRoot.attr("data-token");this.checkbox=this.domRoot.find('input[type="checkbox"]');this.status=this.checkbox.attr("checked");this.setStatusClass();this.initEvents();},setStatusClass:function(){this.domRoot.removeClass(this.classes.on).removeClass(this.classes.off);this.domRoot.addClass(this.isChecked()?this.classes.on:this.classes.off);},initEvents:function(){var thisContext=this;this.domRoot.delegate('input[type="checkbox"]',"change",function(){thisContext.setIsLoading();thisContext.saveCheckboxStatus(thisContext.getSaveStatusUri());});},setIsLoading:function(){this.domRoot.addClass(this.classes.loading);},setIsNotLoading:function(){this.domRoot.removeClass(this.classes.loading);
},isChecked:function(){return this.domRoot.find('input[type="checkbox"]').attr("checked");},getSaveStatusUri:function(){var url=new BLIP.Utils.UrlBuilder(this.uri);url.addParam(this.token,this.isChecked()?1:0);url.addParam("no_wrap","1");return url.getFullUrl();},saveCheckboxStatus:function(uri){var thisContext=this;this.setStatusClass();$.getJSON(uri,function(response){thisContext.setIsNotLoading();return response.error?thisContext.saveFailure(response.error):thisContext.saveSuccess();});},saveFailure:function(error){var checkbox=this.domRoot.find('input[type="checkbox"]');checkbox.attr("checked",!checkbox.attr("checked"));},saveSuccess:function(){}});BLIP.Class.create("BLIP.Unit.AjaxCheckbox.SharingStatus",BLIP.Unit.AjaxCheckbox,function(config){BLIP.Unit.AjaxCheckbox.call(this,config);},{selector:".SharingStatus",init:function(){this.addEventListener("SocialBroadcastStart",this.delegate(this.on_socialBroadcastStart));this.addEventListener("viewer.permissions-denied",this.delegate(this.on_viewerPermissionsDenied));
BLIP.Unit.AjaxCheckbox.prototype.init.call(this);},on_viewerPermissionsDenied:function(){this.domRoot.find('input[type="checkbox"]').attr("checked","");this.setIsLoading();this.saveCheckboxStatus();},saveCheckboxStatus:function(url){var dialog,status=this.isChecked(),thisContext=this;this.fireEvent("SharingStatusChanged",status);if(!status){BLIP.Unit.AjaxCheckbox.prototype.saveCheckboxStatus.call(this,url);return;}FB.api("/me/permissions",function(response){var permissions={};if(response.error&&response.error.type==="OAuthException"){return;}if(response&&response.data&&response.data.length){permissions=response.data[0];}if(!permissions.publish_actions){dialog=new BLIP.Unit.Modal.SocialPermissions();dialog.permissionsAccepted.addListener(function(){BLIP.Unit.AjaxCheckbox.prototype.saveCheckboxStatus.call(thisContext,url);});dialog.open();}else{BLIP.Unit.AjaxCheckbox.prototype.saveCheckboxStatus.call(thisContext,url);}});},on_socialBroadcastStart:function(){var thisContext=this;clearTimeout(this.broadcastActivityTimeout);
this.broadcastActivityTimeout=setTimeout(function(){thisContext.domRoot.removeClass("Working");},5000);this.domRoot.addClass("Working");}});BLIP.Class.create("BLIP.Unit.SocialSettings",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".SharingSettings",broadcastNoticeCookie:"bcstnotice",init:function(){var thisContext=this;debug("social settings init");this.sharingStatus=this.initSubUnit(BLIP.Unit.AjaxCheckbox.SharingStatus).single();this.sendWatchStatus=new BLIP.Unit.AjaxCheckbox({domRoot:this.domRoot.find(".AjaxCheckbox.Watches")});this.sendFollowsStatus=new BLIP.Unit.AjaxCheckbox({domRoot:this.domRoot.find(".AjaxCheckbox.Follows")});this.sendLovesStatus=new BLIP.Unit.AjaxCheckbox({domRoot:this.domRoot.find(".AjaxCheckbox.Loves")});this.addEventListener("SharingStatusChanged",this.delegate(this.on_sharingStatusChanged));this.domRoot.delegate("#ShowBroadcastNotices","change",function(){BLIP.Utils.setCookie({name:thisContext.broadcastNoticeCookie,value:this.checked?"1":"0"});
});if(BLIP.Page.currentViewer&&BLIP.Page.currentViewer.is_ready){this.initializeViewerSettings(BLIP.Page.currentViewer.data);}this.addEventListener("viewer.dataready",this.delegate(this.initializeViewerSettings));},initializeViewerSettings:function(viewerData){debug("viewer settings initializing:");debug(viewerData);this.sharingStatus.checkbox.attr("checked",viewerData.send_social?"checked":null);this.sharingStatus.setStatusClass();this.sendWatchStatus.checkbox.attr("checked",viewerData.send_watches?"checked":null);this.sendWatchStatus.setStatusClass();this.sendLovesStatus.checkbox.attr("checked",viewerData.send_loves?"checked":null);this.sendLovesStatus.setStatusClass();this.sendFollowsStatus.checkbox.attr("checked",viewerData.send_show_follows?"checked":null);this.sendFollowsStatus.setStatusClass();this.updateEnabledStatus();this.fireEvent("viewer.permissions.ready");this.domRoot.show();},updateEnabledStatus:function(){if(!this.sharingStatus.isChecked()){this.domRoot.addClass("Disabled");
this.domRoot.find(".SocialSettings").addClass("Disabled");this.domRoot.find('.SocialSettings input[type="checkbox"]').attr("disabled","disabled");}else{this.domRoot.removeClass("Disabled");this.domRoot.find(".SocialSettings").removeClass("Disabled");this.domRoot.find('.SocialSettings input[type="checkbox"]').attr("disabled",false);}},on_sharingStatusChanged:function(status){this.updateEnabledStatus();}});BLIP.Class.create("BLIP.Unit.SearchField",BLIP.Unit,function(config){this.onOpened=config.onOpened;this.currentlySelectedItem=null;BLIP.Unit.call(this,config);},{selector:".SearchHeader",init:function(){this.searchForm=this.domRoot;this.searchField=this.searchForm.children("input");this.initContents();this.initEvents();if(this.searchField.val()!==""){this.search();if(this.onOpened){this.onOpened();}}},initContents:function(){},initEvents:function(){var thisContext=this;this.searchField.keyup(this.delegate(this.onKeyUp));this.searchField.keydown(this.delegate(this.onKeyDown));$("body").live("click",this.delegate(this.onClickOutside));
},onClickOutside:function(ev){if(!$(ev.target).parents(this.selector).length){this.close();}},onKeyDown:function(e){switch(e.keyCode){case 38:this.moveUp();e.preventDefault();break;case 40:this.moveDown();e.preventDefault();break;case 13:this.onEnterPress(e);break;case 27:this.close();break;}this.searchTerm=this.searchField.val();debug("down:"+this.searchField.val());return true;},onKeyUp:function(e){if(this.searchTerm!==this.searchField.val()){this.search();}if(this.searchField.val().length<1){this.close();}},close:function(){this.domRoot.removeClass("Open");this.currentlySelectedItem=null;this.domRoot.find(".ResultItem.Active").removeClass("Active");},moveDown:function(){if(!this.resultItems.length){return;}else{if(this.currentlySelectedItem+1<this.resultItems.length){this.resultItems[this.currentlySelectedItem].deselect();this.currentlySelectedItem++;}}this.resultItems[this.currentlySelectedItem].select();},moveUp:function(){if(!this.resultItems.length){return;}this.resultItems[this.currentlySelectedItem].deselect();
if(this.currentlySelectedItem>0){this.currentlySelectedItem--;}else{this.currentlySelectedItem=0;}this.resultItems[this.currentlySelectedItem].select();},onEnterPress:function(ev){if(this.currentlySelectedItem!==null&&this.currentlySelectedItem>0){this.resultItems[this.currentlySelectedItem].activate();}else{this.fireEvent("search.query",this.searchTerm);setTimeout(this.delegate(function(){this.domRoot.submit();}),500);}ev.preventDefault();ev.stopPropagation();return false;},search:function(){this.searchTerm=this.searchField.val();if(this.searchTerm.length<2){return;}this.domRoot.addClass("Loading").find(".Indicator .Term").html(this.searchTerm);if(this.searchTerm===""){this.searchForm.removeClass("Open");this.results.hide();return;}$.get("/search/get_auto_complete",{q:this.searchTerm,no_wrap:1},this.delegate(this.onSearchResponse),"json");},onSearchResponse:function(response){var series=$('<div class="Series"></div>'),channels=$('<div class="Categories"></div>'),explore=$('<div class="Explore"></div>'),resultItems=this.resultItems=[];
this.domRoot.removeClass("Loading").find(".SearchResults").empty();this.domRoot.find(".SearchResults").append(this.createSearchSection([],"Explore Blip","Search for&hellip; {TERM}")).append(this.createSearchSection(response.shows,"Series","Search series for&hellip; {TERM}")).append(this.createSearchSection(response.episodes,"Episodes","Search episodes for&hellip; {TERM}")).append(this.createSearchSection(response.channels,"Categories","Search categories for&hellip; {TERM}"));this.currentlySelectedItem=0;this.resultItems[0].select();this.domRoot.addClass("Open");this.onOpened();},createSearchSection:function(data,resultsLabel,searchTemplate){var section=$("<div></div>").addClass(resultsLabel.split(" ")[0]),i;section.append($("<strong>"+resultsLabel+"</strong>"));if(data&&data.length){for(i=0;i<data.length;i++){if(!data[i].name||!data[i].result_url){continue;}section.append(this.createEntry(data[i]).domRoot.addClass(i==0?"First":""));}}else{section.append(this.createEntry({name:searchTemplate.replace("{TERM}","<strong>"+BLIP.Utils.escapeHTML(this.searchField.val())+"</strong>"),result_url:"/search?q="+encodeURIComponent(this.searchField.val()),self_hilighted:true}).domRoot);
}if(section.find(".ResultItem").length){return section;}else{return"";}},createEntry:function(item){var entry=new BLIP.Unit.SearchResult();entry.setContentText(item.name);entry.setHref(item.result_url);if(item.series_name){entry.setSeriesTitle(item.series_name);}if(item.episode_title){entry.setEpisodeTitle(item.episode_title);}if(item.self_hilighted){entry.domRoot.addClass("Highlight");}entry.highlightTerm(this.searchField.val());this.resultItems.push(entry);return entry;}});BLIP.Class.create("BLIP.Unit.SearchResult",BLIP.Unit,function(config){config=config?config:{};config.domRoot=$('<a class="ResultItem"></a>'),BLIP.Unit.call(this,config);},{init:function(){this.domRoot.hover(function(){$(".ResultItem.Active").removeClass("Active");$(this).addClass("Active");},function(){$(this).removeClass("Active");});this.domRoot.click(this.delegate(function(ev){ev.preventDefault();this.activate();}));},setContentText:function(content){this.text=content;this.domRoot.html(content);},setSeriesTitle:function(title){debug("title set: "+title);
this.seriesTitle=title;},setEpisodeTitle:function(title){debug("title set: "+title);this.episodeTitle=title;},highlightTerm:function(term){this.term=term;this.domRoot.html(this.domRoot.html().replace(new RegExp(term,"i"),function(term){return"<strong>"+BLIP.Utils.escapeHTML(term)+"</strong>";}));},setHref:function(href){this.domRoot.attr("href",href);},select:function(){this.domRoot.addClass("Active");},deselect:function(){this.domRoot.removeClass("Active");},activate:function(){var eventData={term:this.term,anchorText:this.text,anchor:this.domRoot};if(this.seriesTitle){eventData.seriesTitle=this.seriesTitle;}if(this.episodeTitle){eventData.episodeTitle=this.episodeTitle;}this.fireEvent("search.quickresult_click",eventData);_Analytics.delayLinkClick(this.domRoot,500);}});BLIP.Class.create("BLIP.Unit.Content",BLIP.Unit,function(config){var thisContext=this;BLIP.Unit.call(this,{domRoot:$("#Content")});this.name=config.name;},{selector:"#Content",registerWithPage:function(){BLIP.Page.registerContent(this);
},setAsCurrentContent:function(){BLIP.Page.setCurrentContent(this.name);},getState:function(){throw new ReferenceError("Static function called without implementation");},setState:function(){throw new ReferenceError("Static function called without implementation");},getStateURI:function(){throw new ReferenceError("Static function called without implementation");}});BLIP.Class.create("BLIP.Unit.Header",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:"#Header",init:function(){var thisContext=this,vSession=BLIP.Utils.getCookie("v_session");this.searchField=this.initSubUnit(BLIP.Unit.SearchField,{onOpened:function(){try{thisContext.captions.each(thisContext.closeUnitDropDown);}catch(x){}}}).single();this.captions=this.initSubUnit(BLIP.Unit.DropDown.HoverDropDown,{captionSelector:".HeaderCaption",onOver:function(){try{thisContext.captions.each(thisContext.closeUnitDropDown);if(thisContext.searchField&&thisContext.searchField.close){thisContext.searchField.close();}}catch(x){}finally{this.openDropDown();
}}});this.initSubUnit(BLIP.Unit.FacebookConnectButton);this.initBroadcastMenu();this.initEvents();this.initTracking();this.initUserActionsMenu();},initEvents:function(){this.addEventListener("viewer.login",this.delegate(this.onViewerLogin));this.addEventListener("viewer.logout",this.delegate(this.onViewerLogout));this.addEventListener("facebook.not_authorized",this.delegate(this.onViewerNotAuthorized));this.addEventListener("viewer.newViewerSignup",this.delegate(this.showOnboardingBug));this.addEventListener("viewer.notificationsUpdated",this.delegate(this.onMyblipNotificationsUpdated));this.domRoot.delegate(".LearnAboutSubscriptions","click",function(){var modal=new BLIP.Unit.Modal.CallToAction.LearnMore({domRoot:$("<a></a>").attr("data-modal-href","/myblip/learn_more?no_wrap=1").attr("data-content-class","LearnAboutSubscriptions"),useStyleWidth:true,useStyleMargin:true,analyticsPrefix:"learn-more"});modal.open();});this.domRoot.delegate(".Menu .Logout","click",function(){BLIP.Page.facebook.logout();
});if(BLIP.Page.currentViewer&&BLIP.Page.currentViewer.is_ready){this.initViewerData(BLIP.Page.currentViewer.data);}this.addEventListener("viewer.dataready",this.delegate(this.initViewerData));$(".ButtonContainer").delegate(".MastheadButton","click",function(evt){var navButton=$(".CategoryMenuButton"),navDropdown=$(".smallScreenLinks"),searchButton=$(".SearchButton"),searchDropdown=$(".SearchHeader");evt.preventDefault();$(this).toggleClass("Active");if($(this).hasClass("CategoryMenuButton")){searchDropdown.slideUp(300);searchButton.removeClass("Active");navDropdown.stop(true,true).slideToggle(300);}else{if($(this).hasClass("SearchButton")){navDropdown.slideUp(300);navButton.removeClass("Active");searchDropdown.stop(true,true).slideToggle(300);}}});},initViewerData:function(data){debug("initializing unwatch count:");debug(data);debug("unwatch count target exists:");debug(!!this.domRoot.find(".NotificationCount").length);this.domRoot.find(".NotificationCount").html(data.unwatched_count>99?"99+":data.unwatched_count);
if(data.unwatched_count>0){if(data.unwatched_count>99){this.domRoot.find(".NotificationCount").addClass("TripleDigit");}else{this.domRoot.find(".NotificationCount").removeClass("TripleDigit");}this.domRoot.find(".NotificationCount").removeClass("Inactive");}},initTracking:function(){this.domRoot.delegate(".NewUserBug .Close","click",this.delegate(function(){this.domRoot.find(".BugWrapper").removeClass("On");setTimeout(this.delegate(function(){this.domRoot.find(".BugWrapper").hide();}),600);}));this.domRoot.delegate(".Nav a:not(.MoreNav), .Logo, .UserActions a","click",function(ev){ev.preventDefault();ev.stopPropagation();BLIP.Page.fireEvent("topnav.click",this);return false;});},onMyblipNotificationsUpdated:function(count){this.domRoot.find(".ViewerIcon .NotificationCount").html(count>99?"99+":count).removeClass("Inactive").addClass(count>99?"TripleDigit":"");},onViewerLogin:function(){var thisContext=this;this.refreshUserActionsMenu();},onFacebookLogout:function(){this.refreshFollows();
this.removeBroadcastMenu();},onViewerLogout:function(){this.removeBroadcastMenu();this.refreshUserActionsMenu({logout:true});},onViewerNotAuthorized:function(){this.domRoot.find(".FacebookLogin").addClass("NotAuthorized");},refreshUserActionsMenu:function(options){var thisContext=this,inLogoutContext=options&&options.logout,usersId,episodeId;if($("#PageInfo").length){usersId=$("#PageInfo").data("users-id");episodeId=$("#PageInfo").data("posts-id");}$.post("/viewers/masthead_menu?no_wrap=1&no-cache=1&episode_id="+episodeId+"&show_id="+usersId,this.delegate(function(response){var userActions=$(response),facebook=userActions.data("facebook"),producer=userActions.data("producer"),actionMenuPresent=!!thisContext.domRoot.find(".UserActions").length;if(facebook||producer){if(actionMenuPresent){thisContext.domRoot.find(".UserActions").replaceWith(response);}else{thisContext.domRoot.find(".FacebookLogin").replaceWith(response);}}else{thisContext.domRoot.find(".UserActions").replaceWith('<div class="LogIn FacebookLogin"><a id="" class="FacebookLoginButton" href="#">Love Blip?<br />Make it yours.</a></div>');
}thisContext.initSubUnit(BLIP.Unit.FacebookConnectButton);thisContext.initUserActionsMenu(options);}));},initUserActionsMenu:function(options){var thisContext=this;inLogoutContext=options&&options.logout;if(!this.domRoot.find(".UserActions").length){return;}this.userActions=new BLIP.Unit.DropDown.HoverDropDown.UserMenu({domRoot:this.domRoot.find(".UserActions"),onOver:function(){if(thisContext.searchField){thisContext.searchField.close();}thisContext.captions.each(thisContext.closeUnitDropDown);this.openDropDown();}});this.userActions.domRoot.delegate("a.You","click",function(){if(thisContext.userActions.domRoot.find(".ProducerTools").length){window.location="/dashboard";}else{window.location="/myblip";}});if(inLogoutContext){this.domRoot.find(".FacebookLogin").addClass("NotAuthorized");}if(BLIP.Page.currentViewer&&BLIP.Page.currentViewer.is_ready){this.initViewerData(BLIP.Page.currentViewer.data);}},initBroadcastMenu:function(){},removeBroadcastMenu:function(){},splitChannelList:function(){var list=this.domRoot.find(".ChannelList .List li"),listLength=list.length,columnLength=Math.floor(listLength/2)+listLength%2,fragment=document.createDocumentFragment(),i=0,currentColumn=null;
list.each(function(n,el){if(n%columnLength===0){if(currentColumn){fragment.appendChild(currentColumn[0]);}currentColumn=$("<ul class='Column'>");$(el).addClass("First");}currentColumn.append(el);});if(currentColumn.find("li").length){fragment.appendChild(currentColumn[0]);}this.domRoot.find(".ChannelList .List").remove();this.domRoot.find(".ChannelList").append(fragment);},closeUnitDropDown:function(unit){unit.closeDropDown();},showOnboardingBug:function(){var thisContext=this;if(window.location.pathname.indexOf("myblip")<0){FB.api("/me",function(response){thisContext.domRoot.find(".NewUserBug .Name").html(response.first_name);thisContext.domRoot.find(".BugWrapper").css("display","block");thisContext.domRoot.find(".BugWrapper").addClass("On");});}}});BLIP.Class.create("BLIP.Unit.Footer",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:"#Footer",init:function(){this.domRoot.delegate(".Links a ","click",function(ev){ev.preventDefault();ev.stopPropagation();BLIP.Page.fireEvent("bottomnav.click",this);
});this.domRoot.delegate(".Producers a, .Connect a, .Copyright a","click",function(ev){ev.preventDefault();ev.stopPropagation();BLIP.Page.fireEvent("footernav.click",this);});}});BLIP.Class.create("BLIP.Unit.TwitterFeed",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".TwitterFeed",init:function(){this.userReg=/(^|\s)@(\w+)/gi;this.hashReg=/(^|\s)#(\w+)/gi;this.urlReg=/(^|\s)(https?:\/\/[\-A-Z0-9+&@#\/%?=~_|!:,.;]*[\-A-Z0-9+&@#\/%=~_|])/gi;this.initContents();},initContents:function(){if(this.domRoot.attr("data-twitter-name").length){var url=new BLIP.Utils.UrlBuilder("/show/get_recent_tweets");url.addParam("screen_name",this.domRoot.attr("data-twitter-name"));url.addParam("no_wrap","1");$.getJSON(url.getFullUrl(),this.delegate(this.on_twitterFeedResults));}},on_twitterComplete:function(xhr,statusText){if(xhr&&xhr.status===400){this.buildTwitterFeed([{text:"Twitter is unavailable right now."}]);}},on_twitterFail:function(){this.buildTwitterFeed([{text:"Twitter is unavailable right now."}]);
},on_twitterFeedResults:function(json){if(json.length>0){this.setTwitterUser(json[0].screen_name);this.buildTwitterFeed(json);}},setTwitterUser:function(user){},getNiceDateTime:function(datetime){var ago=$.timeago(datetime);return ago.indexOf("NaN")>=0||!ago.length?"Some time ago":ago;},buildTwitterFeed:function(json){var feedUL=this.domRoot.find("ul.Feed"),i,feedItem;for(i=0,len=json.length;i<len;i++){feedItem=this.buildTwitterFeedItem(json[i]);feedUL.append(feedItem);}this.fadeInTwitterFeed();this.startFeedCycle();},buildTwitterFeedItem:function(post){var twitterLink,userPattern='$1<a href="http://twitter.com/$2" rel="nofollow" target="_blank">@$2</a>',hashPattern='$1<a href="http://twitter.com/search/%23$2" rel="nofollow" target="_blank">#$2</a>',urlPattern='$1<a href="http://$2" rel="nofollow" target="_blank">$2</a>',postText,anchor;twitterLink=["http://www.twitter.com",post.screen_name,"statuses",post.tweet_id].join("/");postText=post.tweet_text.replace(this.userReg,userPattern).replace(this.hashReg,hashPattern).replace(this.urlReg,function(url){var textArr=[],text="",i;
for(i=0,l=url.length;i<l;i++){textArr.push(url.charAt(i)+"<wbr />");}text=textArr.join("");return['<a href="',url,'" rel="nofollow" target="_blank">',text,"</a>"].join("");});anchor=$("<a>").addClass("TimePosted").attr("href",twitterLink).attr("rel","nofollow").attr("target","_blank").css("display","none").append().append(this.getNiceDateTime(post.datestamp));return $('<li style="display:none;">').append($("<div class='Post' />").append(postText)).append(anchor);},fadeInTwitterFeed:function(){this.domRoot.find(".LoadingWrap").fadeIn();},startFeedCycle:function(){var thisContext=this,n=0,maxN=this.domRoot.find("li").length;thisContext.domRoot.find("li").eq(0).fadeIn();setInterval(function(){thisContext.domRoot.find("li").eq(n).fadeOut(function(){n=n<maxN-1?n+1:0;thisContext.domRoot.find("li").eq(n).fadeIn();});},5000);}});BLIP.Class.create("BLIP.Unit.DeferredImage",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".DeferredImage",init:function(){this.initContents();},initContents:function(){var imageElement=this.domRoot.first(),imageSource=imageElement.attr("data-image-src");
if(imageElement.is(":visible")){imageElement.attr("src",imageSource);}}});BLIP.Class.create("BLIP.Unit.Modal",BLIP.Unit,function(config){this.subUnit=config.subUnit;this.useStyleWidth=config.useStyleWidth;this.useStyleMargin=config.useStyleMargin;if(config&&config.contentRoot){this.contentRoot=config.contentRoot;}BLIP.Unit.call(this,config);},{selector:"[rel='modal']",modalID:"Modal",rewrite:true,init:function(){this.modalLink=this.domRoot;this.createModal();this.initEvents();this.onModalOpen=new BLIP.Utils.LocalEvent("onModalOpen");this.onModalClose=new BLIP.Utils.LocalEvent("onModalClose");},initEvents:function(){this.modalLink.bind("click",this.delegate(this.on_modalLinkClick));},initModalUnits:function(){if(this.subUnit){this.initSubUnit(this.subUnit);}},on_modalShadeClick:function(event){var thisContext=this;try{this.close();}catch(x){}finally{return false;}},on_modalLinkClick:function(event){try{this.open();}catch(x){this.log(x);}finally{if(event){event.preventDefault();event.stopPropagation();
}return false;}},open:function(){this.fireEvent("pause");this.domRoot.fadeIn(this.delegate(function(){this.domRoot.find(".Content").show();}));this.getModalContents();this.onModalOpen.fire();},close:function(){var thisContext=this;this.domRoot.fadeOut(function(){thisContext.domRoot.hide();thisContext.domRoot.find(".Content").hide();thisContext.domRoot.find(".Close, .Shade").unbind();thisContext.onModalClose.fire();});},getModalUrl:function(){var url=new BLIP.Utils.UrlBuilder(this.modalLink.attr("data-modal-href"));url.addParam("no-cache","1");return url.getFullUrl();},getModalContents:function(){$.get(this.getModalUrl(),this.delegate(this.fillModal));},fillModal:function(content){this.domRoot.find(".Content").html(content);this.setContentDimensions();this.domRoot.find(".Content").attr("class","").addClass("Content").prepend(this.closeButton).fadeIn("fast",this.delegate(this.initModalUnits));this.attachModalEvents();},attachModalEvents:function(){this.domRoot.find(".Shade, .Close").bind("click",this.delegate(this.on_modalShadeClick));
},getContentDimensions:function(){var includedContent=this.domRoot.find(".Content").children("div");return[includedContent.outerWidth(),includedContent.outerHeight()];},setContentDimensions:function(positionOverride){var content=this.domRoot.find(".Content"),includedContent=content.children("div"),dim=this.getContentDimensions(),viewport=[$(window).width(),$(window).height()],top;if(dim){top=positionOverride?positionOverride.top:((viewport[1]-dim[1])/2);content.width(dim[0]);content.css("top",top+"px");}},createModal:function(){this.closeButton=$('<div class="Close"></div>').bind("click",this.delegate(this.on_modalShadeClick));if($("#"+this.modalID).length){this.domRoot=$("#"+this.modalID);}else{this.domRoot=$("<div class='Modal' id='"+this.modalID.replace("#","")+"' style='display:none'><div class='Shade'></div><div class='Content'></div></div>");$(document.body).append(this.domRoot);}}});BLIP.Class.create("BLIP.Unit.Modal.CallToAction",BLIP.Unit.Modal,function(config){if(config.domRoot.attr("data-content-class")){this.contentClass=config.domRoot.attr("data-content-class");
}BLIP.Unit.Modal.call(this,config);},{analytics:{category:_Analytics.categories.callToAction,prefix:null,openAction:_Analytics.actions.view},init:function(){BLIP.Unit.Modal.prototype.init.call(this);this.addEventListener("viewer.login",this.delegate(this.close));},open:function(){BLIP.Unit.Modal.prototype.open.call(this);_Analytics.trackEvent(this.analytics.category,_Analytics.prefix(this.analytics.prefix,this.analytics.openAction),this.analytics.label?this.analytics.label:undefined);},initModalUnits:function(){this.connectButton=this.initSubUnit(BLIP.Unit.FacebookConnectButton).single();this.connectButton.prefix=this.analytics.prefix;},fillModal:function(content){BLIP.Unit.Modal.prototype.fillModal.call(this,content);if(this.contentClass){this.domRoot.find(".Content").addClass(this.contentClass);}},setContentDimensions:function(){this.domRoot.find(".Content").css("top",120+"px");}});BLIP.Class.create("BLIP.Unit.Modal.CallToAction.LearnMore",BLIP.Unit.Modal.CallToAction,function(config){this.domRoot=$("<a></a>").attr("data-modal-href","/myblip/learn_more?no_wrap=1").attr("data-content-class","LearnAboutSubscriptions");
BLIP.Unit.Modal.CallToAction.call(this,config);this.analytics.prefix="learn-more";},{init:function(){BLIP.Unit.Modal.CallToAction.prototype.init.call(this);}});BLIP.Class.create("BLIP.Unit.Modal.CallToAction.Follow",BLIP.Unit.Modal.CallToAction,function(config){this.domRoot=$("<a></a>").attr("data-modal-href","/myblip/follow_onboard?no_wrap=1").attr("data-content-class","FollowOnboard");BLIP.Unit.Modal.CallToAction.call(this,config);this.analytics.prefix="follow";},{init:function(){BLIP.Unit.Modal.CallToAction.prototype.init.call(this);}});BLIP.Class.create("BLIP.Unit.Modal.FacebookConnect",BLIP.Unit.Modal,function(config){if(config.domRoot.attr("data-content-class")){this.contentClass=config.domRoot.attr("data-content-class");}this.analyticsPrefix=config.analyticsPrefix||null;BLIP.Unit.Modal.call(this,config);this.addEventListener("viewer.login",this.delegate(this.close));},{selector:"#FollowLoginModal",modalID:"FollowLoginModal",getContentDimensions:function(){},initEvents:function(){var thisContext=this;
BLIP.Unit.Modal.prototype.initEvents.call(this);this.domRoot.undelegate(".FacebookLoginButton","click");this.domRoot.delegate(".FacebookLoginButton","click",function(ev){ev.stopPropagation();ev.preventDefault();BLIP.Page.facebook.login();});this.addEventListener("viewer.login",function(data){if(thisContext.analyticsPrefix){thisContext.fireEvent("callToAction.facebookConnected",{isNewUser:data.isNewUser,action:thisContext.analyticsPrefix});}thisContext.close();});},getModalContents:function(){if(this.modalLink.attr("data-modal-href")){BLIP.Unit.Modal.prototype.getModalContents.call(this);}else{this.setContentDimensions({top:190});this.attachModalEvents();this.domRoot.find(".Content").prepend(this.closeButton);}},fillModal:function(content){BLIP.Unit.Modal.prototype.fillModal.call(this,content);if(this.contentClass){this.domRoot.find(".Content").addClass(this.contentClass);}},open:function(){if(this.analyticsPrefix){this.fireEvent("callToAction.modalOpen",{action:this.analyticsPrefix});}BLIP.Unit.Modal.prototype.open.call(this);
},close:function(){this.fireEvent("followmodal.close");BLIP.Unit.Modal.prototype.close.call(this);}});BLIP.Class.create("BLIP.Unit.Modal.SocialPermissions",BLIP.Unit.Modal,function(config){this.modalID="SocialPermissions";this.permissionsAccepted=new BLIP.Utils.LocalEvent("PermissionsAccepted");BLIP.Unit.Modal.call(this,{domRoot:$('<a data-modal-href="/subscriptions/permissions_dialog?no_wrap=1"></a>'),useStyleWidth:config?config.useStyleWidth:null,useStyleMargin:config?config.useStyleMargin:null});},{getContentDimensions:function(){return[580,420];},initModalUnits:function(){this.domRoot.find(".TurnOn").click(this.delegate(this.requestPermissions));this.domRoot.delegate(".TurnOff","click",this.delegate(this.denyPermissions));},createModal:function(){BLIP.Unit.Modal.prototype.createModal.call(this);this.domRoot.addClass("Modal");},requestPermissions:function(){var thisContext=this;FB.login(function(response){if(response.status==="unknown"){thisContext.denyPermissions();}else{thisContext.permissionsAccepted.fire();
thisContext.close();}},{scope:[BLIP.Page.facebook.permissions,"publish_actions"].join(",")});},denyPermissions:function(){this.close();this.fireEvent("viewer.permissions-denied");},on_modalShadeClick:function(){this.denyPermissions();BLIP.Unit.Modal.prototype.on_modalShadeClick.call(this);}});BLIP.Class.create("BLIP.Unit.Modal.SocialShareActions",BLIP.Unit.Modal,function(config){BLIP.Unit.Modal.call(this,config);},{selector:"a[rel=ShareModal]",modalID:"Modal",attachModalEvents:function(){BLIP.Unit.Modal.prototype.attachModalEvents.call(this);this.initCopyButton("ModalCopyLinkButton","ModalCopyLinkContainer");if($(this.domRoot).find("#ModalCopyEmbedButtonContainer").length>0){this.initCopyButton("ModalCopyEmbedButton","ModalCopyEmbedButtonContainer");}this.registerPageView();this.initThirdPartyButtons();},initCopyButton:function(idButton,idContainer){var clip=null,button=$("#"+idButton),buttonText=button.text(),thisContext=this;ZeroClipboard.setMoviePath("/scripts/flash/ZeroClipboard.swf");
clip=new ZeroClipboard.Client();clip.setHandCursor(true);clip.setCSSEffects(true);clip.setText(this.domRoot.find("#"+idButton).data("copy-text"));clip.addEventListener("complete",function(client,text){button.text("Copied!");window.setTimeout(function(){button.text(buttonText);},3000);});clip.glue(idButton,idContainer);},initThirdPartyButtons:function(){this.initGoogle();this.initStumbleUpon();},initTwitter:function(){!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");},initGoogle:function(){var po,s;po=document.createElement("script");po.type="text/javascript";po.async=true;po.src="https://apis.google.com/js/plusone.js";s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(po,s);},initStumbleUpon:function(){var li,s;li=document.createElement("script");li.type="text/javascript";li.async=true;li.src="https://platform.stumbleupon.com/1/widgets.js";
s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(li,s);},registerPageView:function(){var isLite=document.getElementById("Content").className.indexOf("Lite")>=0,objectType=this.domRoot.find(".ShareActions")[0].getAttribute("data-share-object-type"),postfix=["share-modal"],hasTrailingSlash=window.location.href.lastIndexOf("/")===(window.location.href.length-1),url=this.analyticsUrl||null;postfix.unshift(objectType);if(isLite){postfix.unshift("lite");}postfix=postfix.join("-");if(!url){url=[window.location.href,postfix].join(hasTrailingSlash?"":"/");}else{url=[window.location.origin,url].join("");}_Analytics.addVariable(1,"template",postfix,3);_Analytics.setVariables();_Analytics.sendPageView(url);},setAnalyticsUrl:function(url){this.analyticsUrl=url;}});BLIP.Class.create("BLIP.Unit.FollowButton",BLIP.Unit,function(config){if(config&&config.showId){this.showId=config.showId;}BLIP.Unit.call(this,config);},{selector:".FollowButton",followUrl:"/viewers/follow_show/",init:function(){this.showId=this.showId||this.domRoot.data("show-id");
this.showName=this.showName||this.domRoot.data("show-name");if(this.domRoot.attr("onclick")){this.domRoot[0].attributes.removeNamedItem("onclick");}this.initEvents();if(this.domRoot.hasClass("FirstTimeWorking")){if(BLIP.Page.facebook.ready){this.preclickContinue();}this.addEventListener("FacebookReady",this.delegate(this.preclickContinue));}},initEvents:function(){this.refreshEventName="viewer.login";this.refreshEventListener=this.addEventListener(this.refreshEventName,this.delegate(this.onFacebookLogin));this.domRoot.click(this.delegate(this.onFollowClick));this.addEventListener("viewer.logout",this.delegate(this.onFacebookLogout));this.addEventListener("followmodal.close",this.delegate(function(){this.domRoot.removeClass("Working FirstTimeWorking");}));this.addEventListener("viewer.dataready",this.delegate(this.detectFollowStatus));this.addEventListener("series.follow",this.delegate(function(){this.detectFollowStatus();}));this.addEventListener("series.unfollow",this.delegate(function(){this.detectFollowStatus();
}));if(BLIP.Page.currentViewer){this.detectFollowStatus();}},changeDetectionEventTo:function(eventName){this.removeEventListener(this.refreshEventName,this.refreshEventListener);this.refreshEventName=eventName;this.addEventListener(this.refreshEventName,this.delegate(this.onFacebookLogin));},preclickContinue:function(){this.onFollowClick();this.domRoot.removeClass("FirstTimeWorking");},onFacebookLogin:function(){if(!this.domRoot.hasClass("Working")){this.detectFollowStatus();}},onFacebookLogout:function(){this.domRoot.removeClass("Working FirstTimeWorking");this.setFollowStatus(false);},detectFollowStatus:function(){var status;if(BLIP.Page.currentViewer){status=BLIP.Page.currentViewer.get("following",this.showId);if(typeof status==="undefined"){BLIP.Page.currentViewer.refreshFollowStatusForShowId(this.showId,this.delegate(this.detectFollowStatus));}this.setFollowStatus(status);}else{this.setFollowStatus(false);}},onFollowClick:function(ev){var thisContext=this,continuation=this.delegate(function(){if(this.isFollowing()){this.unfollow(this.delegate(this.unfollow));
}else{this.follow(this.showId);}}),loginContinuation=function(){continuation();thisContext.removeEventListener("viewer.login",loginContinuation);};ev.preventDefault();ev.stopPropagation();if(this.domRoot.hasClass("Working")||this.domRoot.hasClass("Following")&&this.domRoot.data("href")){return false;}this.domRoot.addClass("Working");if(BLIP.Utils.getCookie("v_session")&&BLIP.Utils.getCookie("v_session")!=="LOGGEDOUT"){continuation();}else{this.addEventListener("viewer.login",loginContinuation);this.showCallToAction();}return false;},showCallToAction:function(){var modal=new BLIP.Unit.Modal.FacebookConnect({domRoot:$("<a></a>").attr("data-modal-href","/myblip/follow_onboard?no_wrap=1").attr("data-content-class","FollowOnboard"),selector:"#FollowL",analyticsPrefix:"follow"});modal.open();},isFollowing:function(){return this.domRoot.hasClass("Following");},buildFollowUrl:function(id){if(this.domRoot.data("href")){return this.domRoot.data("href");}else{var url=new BLIP.Utils.UrlBuilder(this.followUrl+id);
url.addParam("no_wrap",1);url.addParam("no-cache",1);return url.getFullUrl();}},follow:function(id,callback){var successContinue=this.delegate(function(response){this.followResponded(response);if(callback){callback(response);}});this.fireEvent("FollowFacebookLoginFinish");if(BLIP.Page.hasFacebookLoggedInCookie()){$.ajax({url:this.buildFollowUrl(id),dataType:"json",method:"get",success:successContinue,error:this.delegate(this.handleFollowError)});}else{this.fireEvent("FollowFacebookLogin");BLIP.Page.facebook.skipFirstTimeRedirect=true;BLIP.Page.facebook.login({success:this.delegate(function(){this.follow(this.showId,callback);}),failure:this.delegate(this.facebookLoginFailure)});}},followResponded:function(response){var thisContext=this;BLIP.Page.facebook.hasPostOnTimelinePermission(function(permissible){if(!permissible&&BLIP.Page.facebook.hasSendFollowPermission()){BLIP.Page.shareNotice({text:"Oops! We tried to share, but lack permissions. Social broadcasting has been disabled.",error:true});
BLIP.Page.fireEvent("viewer.permissions-denied");}if(response&&response.error===1){thisContext.handleFollowError();}else{thisContext.handleFollowSuccess(response);}});},handleFollowSuccess:function(response){var ogNamespace=$('meta[property="namespace"]').attr("content"),showUri=[window.location.origin,this.domRoot.attr("data-path")].join("/"),thisContext=this;this.setFollowStatus(true);this.domRoot.removeClass("Working FirstTimeWorking");this.fireEvent("FollowingShow");this.fireEvent("FollowsUpdated");this.fireEvent("series.follow",{showName:response.data,context:this.getAnalyticsContext()});},handleFollowError:function(){},facebookLoginFailure:function(){this.fireEvent("FollowFacebookLoginFinish");this.domRoot.removeClass("Working FirstTimeWorking");},unfollow:function(){$.getJSON("/viewers/unfollow_show/"+this.showId+"?no_wrap=1&no-cache=1",this.delegate(this.unfollowResponded));},unfollowResponded:function(response){this.setFollowStatus(false);this.fireEvent("UnfollowShow",{showId:this.showId,element:this.domRoot});
this.fireEvent("FollowsUpdated");this.fireEvent("series.unfollow",{context:this.getAnalyticsContext()});},getFollowStatus:function(callback){$.getJSON("/viewers/get_user_events/"+this.showId+"?no_wrap=1&no-cache=1",callback);},getFollowStatusResponded:function(response){if(response&&response.following==="1"){this.setFollowStatus(true);}else{if(response&&response.error){return;}else{this.setFollowStatus(false);}}},setFollowStatus:function(isFollowing){if(isFollowing){this.domRoot.addClass("Following").removeClass("NotFollowing");}else{this.domRoot.removeClass("Following").addClass("NotFollowing");}this.domRoot.removeClass("Working FirstTimeWorking Uninitialized");if(BLIP.Page.currentViewer){BLIP.Page.currentViewer.set("following",this.showId,isFollowing);}},getPackLabel:function(){return window.location.pathname.split("/")[window.location.pathname.split("/").length-1];},isEpisodePage:function(){return !!$("#PageInfo").attr("data-posts-id");}});BLIP.Class.create("BLIP.Unit.FollowButton.LazyFollowButton",BLIP.Unit.FollowButton,function(config){BLIP.Unit.FollowButton.call(this,config);
},{initEvents:function(){this.refreshEventName="viewer.login";this.refreshEventListener=this.addEventListener(this.refreshEventName,this.delegate(this.onFacebookLogin));this.domRoot.click(this.delegate(this.onFollowClick));this.addEventListener("viewer.logout",this.delegate(this.onFacebookLogout));this.addEventListener("followmodal.close",this.delegate(function(){this.domRoot.removeClass("Working FirstTimeWorking");}));this.addEventListener("viewer.dataready",this.delegate(this.detectFollowStatus));this.addEventListener("series.follow",this.delegate(function(){this.detectFollowStatus();}));this.addEventListener("series.unfollow",this.delegate(function(){this.detectFollowStatus();}));},onFacebookLogin:function(){}});BLIP.Class.create("BLIP.Unit.LoveButton",BLIP.Unit,function(config){if(config&&config.episodeId){this.episodeId=config.episodeId;}if(config&&config.analytics){this.analytics=config.analytics;}BLIP.Unit.call(this,config);},{selector:".LoveButton",loveUrl:"/viewers/love/",init:function(){this.episodeId=this.episodeId||this.domRoot.data("episode-id");
this.initEvents();},initEvents:function(){this.refreshEventName="viewer.login";this.refreshEventListener=this.addEventListener(this.refreshEventName,this.delegate(this.onFacebookLogin));this.domRoot.click(this.delegate(this.onLoveClick));this.addEventListener("viewer.logout",this.delegate(this.onFacebookLogout));this.addEventListener("followmodal.close",this.delegate(function(){this.domRoot.removeClass("Working");}));this.addEventListener("viewer.dataready",this.delegate(this.detectLoveStatus));},onFacebookLogin:function(){if(!this.domRoot.hasClass("Working")){this.detectLoveStatus();}},onFacebookLogout:function(){this.domRoot.removeClass("Working Active");this.setLoveStatus(false);},detectLoveStatus:function(){if(BLIP.Page.currentViewer){if($("#Content").hasClass("Episode")){this.setLoveStatus(BLIP.Page.currentViewer.get("loved"));}else{this.getLoveStatus(this.delegate(function(response){if(response&&response.love==="1"){this.setLoveStatus(true);}else{this.setLoveStatus(false);}}));}}else{this.setLoveStatus(false);
}},onLoveClick:function(){var thisContext=this,continuation=this.delegate(function(){if(this.isLoved()){this.unlove(this.delegate(this.unlove));}else{this.love(this.episodeId);}}),loginContinuation=function(){continuation();thisContext.removeEventListener("viewer.login",loginContinuation);};if(this.domRoot.hasClass("Working")){return;}this.domRoot.addClass("Working");if(BLIP.Page.hasFacebookLoggedInCookie()){continuation();}else{this.addEventListener("viewer.login",loginContinuation);this.showCallToAction();}},isLoved:function(){return this.domRoot.hasClass("Active");},showCallToAction:function(){var modal=new BLIP.Unit.Modal.FacebookConnect({domRoot:$("<a></a>").attr("data-modal-href","/myblip/love_onboard?no_wrap=1").attr("data-content-class","LoveOnboard"),selector:"#FollowLoginModal",analyticsPrefix:"love"});modal.open();},buildLoveUrl:function(id){if(this.domRoot.data("href")){return this.domRoot.data("href");}else{var url=new BLIP.Utils.UrlBuilder(this.loveUrl+id);url.addParam("no_wrap",1);
url.addParam("no-cache",1);return url.getFullUrl();}},love:function(id,callback){var successContinue=this.delegate(function(response){this.loveResponded(response);if(callback){callback(response);}});if(BLIP.Page.hasFacebookLoggedInCookie()){$.ajax({url:this.buildLoveUrl(id),dataType:"json",method:"get",success:successContinue,error:this.delegate(this.handleLoveError)});}else{this.fireEvent("FollowFacebookLogin");BLIP.Page.facebook.skipFirstTimeRedirect=true;BLIP.Page.facebook.login({success:this.delegate(function(){this.love(this.showId,callback);}),failure:this.delegate(this.facebookLoginFailure)});}},loveResponded:function(response){var thisContext=this;BLIP.Page.facebook.hasPostOnTimelinePermission(function(permissible){if(!permissible&&BLIP.Page.facebook.hasSendLovePermission()){BLIP.Page.shareNotice({text:"Oops! We tried to share, but lack permissions. Social broadcasting has been disabled.",error:true});BLIP.Page.fireEvent("viewer.permissions-denied");}if(response&&response.error===1){thisContext.handleLoveError();
}else{thisContext.handleLoveSuccess(response);}});},handleLoveSuccess:function(response){this.setLoveStatus(true);this.domRoot.removeClass("Working");this.fireEvent("viewer.lovedEpisode",{episodeId:this.episodeId,element:this.domRoot});if(response.data){this.fireEvent("episode.love",{series:response.data.series,episode:response.data.episode,categories:response.data.channels});}if(this.analytics){_Analytics.trackEvent(this.analytics.love.category,this.analytics.love.action,this.analytics.love.label);}},handleLoveError:function(){this.log("LoveButton have a love error :(");},facebookLoginFailure:function(){this.fireEvent("FollowFacebookLoginFinish");this.domRoot.removeClass("Working Active");},unlove:function(){$.getJSON("/viewers/unlove/"+this.episodeId+"?no_wrap=1&no-cache=1",this.delegate(this.unloveResponded));},unloveResponded:function(response){this.setLoveStatus(false);this.fireEvent("viewer.unlovedEpisode",{episodeId:this.episodeId,element:this.domRoot});if(this.analytics){_Analytics.trackEvent(this.analytics.unlove.category,this.analytics.unlove.action,this.analytics.unlove.label);
}},getLoveStatus:function(callback){$.getJSON("/viewers/get_post_events/"+this.episodeId+"?no_wrap=1&no-cache=1",callback);},getLoveStatusResponded:function(response){if(response&&response.love==="1"){this.setLoveStatus(true);}else{if(response&&response.error){return;}else{this.setLoveStatus(false);}}},setLoveStatus:function(isLoved){if(isLoved){this.domRoot.addClass("Active");}else{this.domRoot.removeClass("Active");}this.domRoot.removeClass("Working");if(BLIP.Page.currentViewer){BLIP.Page.currentViewer.set("loved",isLoved);}}});BLIP.Class.create("BLIP.Unit.LoveButton.LazyLoveButton",BLIP.Unit.LoveButton,function(config){BLIP.Unit.LoveButton.call(this,config);},{initEvents:function(){this.refreshEventName="viewer.login";this.refreshEventListener=this.addEventListener(this.refreshEventName,this.delegate(this.onFacebookLogin));this.domRoot.click(this.delegate(this.onLoveClick));this.addEventListener("viewer.logout",this.delegate(this.onFacebookLogout));this.addEventListener("followmodal.close",this.delegate(function(){this.domRoot.removeClass("Working");
}));},onFacebookLogin:function(){}});BLIP.Class.create("BLIP.Unit.PosterCard",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".PosterCard",init:function(){this.initContents();this.initEvents();},initContents:function(){this.actionTab=new BLIP.Unit.ActionTab({domRoot:this.domRoot.children(".ActionTab")});this.actionTab.setShowPageUrl(this.domRoot.data("show-page-url"));BLIP.Utils.upgradeToRetina(this.domRoot);},initEvents:function(){var thisContext=this;this.domRoot.unbind();this.domRoot.hover(this.delegate(this.onHoverIn),this.delegate(this.onHoverOut));this.domRoot.find(".ArrowIcon").click(this.delegate(this.closeInfo));this.domRoot.delegate("a","click",this.delegate(function(event){if($("#Content").hasClass("Search")){event.preventDefault();$(window).trigger("searchposter.click",{link:$(event.currentTarget),originalEvent:event});}}));},onHoverIn:function(){this.inTimeout=setTimeout(this.delegate(this.openInfo),600);this.actionTab.onPosterHover();},onHoverOut:function(){clearTimeout(this.inTimeout);
this.closeInfo();},openInfo:function(){this.domRoot.addClass("Active");},closeInfo:function(){this.domRoot.removeClass("Active");}});BLIP.Class.create("BLIP.Unit.EpisodeCard",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".MyBlipEpisodeCard",init:function(){this.initContents();this.initEvents();},initContents:function(){this.actionTab=new BLIP.Unit.ActionTab({domRoot:this.domRoot.children(".ActionTab")});BLIP.Utils.upgradeToRetina(this.domRoot);},initEvents:function(){var thisContext=this;this.domRoot.unbind();this.domRoot.hover(this.delegate(this.onHoverIn),this.delegate(this.onHoverOut));this.domRoot.delegate("a.EpisodeCardLink","click",function(ev){console.log("card origin click");thisContext.fireEvent("episodeCard.click",{link:this,page:document.getElementById("Content").className,context:thisContext.getAnalyticsContext(),originalEvent:ev});});},onHoverIn:function(){this.actionTab.onEpisodeHover();},onHoverOut:function(){clearTimeout(this.inTimeout);this.closeInfo();
}});BLIP.Class.create("BLIP.Unit.ActionTab",BLIP.Unit,function(config){BLIP.Unit.call(this,config);},{selector:".ActionTab",init:function(){this.initContents();this.initEvents();this.checkedStatus=false;},initContents:function(){var thisContext=this;this.initFollowButton();this.initLoveButton();this.shareButton=new BLIP.Unit.Modal.SocialShareActions({domRoot:this.domRoot.find(".SocialActions")});this.domRoot.find(".ActionTabMenu .SocialActions").click(function(){thisContext.fireEvent("share.open",{context:thisContext.getAnalyticsContext()});});},setShowPageUrl:function(showPageUrl){this.shareButton.setAnalyticsUrl([showPageUrl,"/poster-card-share-modal"].join(""));},initEvents:function(){this.domRoot.unbind();this.addEventListener("followmodal.close",this.delegate(this.resetStatus));},initFollowButton:function(){if(this.domRoot.find(".Follow").length>0){this.followButton=new BLIP.Unit.FollowButton.LazyFollowButton({domRoot:this.domRoot.find(".Follow"),showId:this.domRoot.data("show-id")});
}},initLoveButton:function(){if(this.domRoot.find(".Love").length>0){this.loveButton=new BLIP.Unit.LoveButton.LazyLoveButton({domRoot:this.domRoot.find(".Love"),episodeId:this.domRoot.data("episode-id")});}},onPosterHover:function(){if(this.followButton&&!this.checkedStatus){this.followButton.detectFollowStatus();this.checkedStatus=true;}},onEpisodeHover:function(){if(this.loveButton&&!this.checkedStatus){this.loveButton.detectLoveStatus();this.checkedStatus=true;}},resetStatus:function(){this.checkedStatus=false;if(this.followButton){this.followButton.setFollowStatus(false);}}});
/*!
 * jQuery Smart Banner
 * Copyright (c) 2012 Arnold Daniels <arnold@jasny.net>
 * Based on 'jQuery Smart Web App Banner' by Kurt Zenisek @ kzeni.com
 */
!function($){var SmartBanner=function(options){this.origHtmlMargin=parseFloat($("body").css("margin-top"));this.options=$.extend({},$.smartbanner.defaults,options);var standalone=navigator.standalone;if(this.options.force){this.type=this.options.force;}else{if(navigator.userAgent.match(/iPad|iPhone|iPod/i)!=null){if(navigator.userAgent.match(/Safari/i)!=null&&(navigator.userAgent.match(/CriOS/i)!=null||window.Number(navigator.userAgent.substr(navigator.userAgent.indexOf("OS ")+3,3).replace("_","."))<6)){this.type="ios";
}}else{if(navigator.userAgent.match(/Android/i)!=null){this.type="android";}}}if(!this.type||standalone||this.getCookie("sb-closed")||this.getCookie("sb-installed")){return;}this.scale=this.options.scale=="auto"?$(window).width()/window.screen.width:this.options.scale;if(this.scale<1){this.scale=1;}var meta=$(this.type=="android"?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]');if(meta.length==0){return;}this.appId=/app-id=([^\s,]+)/.exec(meta.attr("content"))[1];this.title=this.options.title?this.options.title:$("title").text().replace(/\s*[|\-·].*$/,"");this.author=this.options.author?this.options.author:($('meta[name="author"]').length?$('meta[name="author"]').attr("content"):window.location.hostname);this.create();this.show();this.listen();};SmartBanner.prototype={constructor:SmartBanner,create:function(){var iconURL,link=(this.options.url?this.options.url:(this.type=="android"?"market://details?id=":("https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id"))+this.appId),inStore=this.options.price?this.options.price+" - "+(this.type=="android"?this.options.inGooglePlay:this.options.inAppStore):"",gloss=this.options.iconGloss===null?(this.type=="ios"):this.options.iconGloss;
$("body").append('<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+inStore+'</span></div><a href="'+link+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>");if(this.options.icon){iconURL=this.options.icon;}else{if($('link[rel="apple-touch-icon-precomposed"]').length>0){iconURL=$('link[rel="apple-touch-icon-precomposed"]').attr("href");if(this.options.iconGloss===null){gloss=false;}}else{if($('link[rel="apple-touch-icon"]').length>0){iconURL=$('link[rel="apple-touch-icon"]').attr("href");}}}if(iconURL){$("#smartbanner .sb-icon").css("background-image","url("+iconURL+")");if(gloss){$("#smartbanner .sb-icon").addClass("gloss");}}else{$("#smartbanner").addClass("no-icon");}this.bannerHeight=$("#smartbanner").outerHeight()+2;if(this.scale>1){$("#smartbanner").css("top",parseFloat($("#smartbanner").css("top"))*this.scale).css("height",parseFloat($("#smartbanner").css("height"))*this.scale);
$("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",$(window).width()/this.scale);}},listen:function(){$("#smartbanner .sb-close").bind("click",$.proxy(this.close,this));$("#smartbanner .sb-button").bind("click",$.proxy(this.install,this));},show:function(callback){$("#smartbanner").stop().animate({top:0},this.options.speedIn).addClass("shown");$("body").animate({marginTop:this.origHtmlMargin+(this.bannerHeight*this.scale)},this.options.speedIn,"swing",callback);},hide:function(callback){$("#smartbanner").stop().animate({top:-1*this.bannerHeight*this.scale},this.options.speedOut).removeClass("shown");$("body").animate({marginTop:this.origHtmlMargin},this.options.speedOut,"swing",callback);},close:function(e){e.preventDefault();this.hide();this.setCookie("sb-closed","true",this.options.daysHidden);},install:function(e){this.hide();this.setCookie("sb-installed","true",this.options.daysReminder);
},setCookie:function(name,value,exdays){var exdate=new Date();exdate.setDate(exdate.getDate()+exdays);value=escape(value)+((exdays==null)?"":"; expires="+exdate.toUTCString());document.cookie=name+"="+value+"; path=/;";},getCookie:function(name){var i,x,y,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++){x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==name){return unescape(y);}}return null;},switchType:function(){var that=this;this.hide(function(){that.type=that.type=="android"?"ios":"android";var meta=$(that.type=="android"?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");that.appId=/app-id=([^\s,]+)/.exec(meta)[1];$("#smartbanner").detach();that.create();that.show();});}};$.smartbanner=function(option){var $window=$(window),data=$window.data("typeahead"),options=typeof option=="object"&&option;if(!data){$window.data("typeahead",(data=new SmartBanner(options)));
}if(typeof option=="string"){data[option]();}};$.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null};$.smartbanner.Constructor=SmartBanner;}(window.jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"/scripts/flash/ZeroClipboard10.swf",nextId:1,$:function(thingy){if(typeof(thingy)=="string"){thingy=document.getElementById(thingy);}if(!thingy.addClass){thingy.hide=function(){this.style.display="none";};thingy.show=function(){this.style.display="";};thingy.addClass=function(name){this.removeClass(name);this.className+=" "+name;};thingy.removeClass=function(name){var classes=this.className.split(/\s+/);var idx=-1;for(var k=0;k<classes.length;k++){if(classes[k]==name){idx=k;k=classes.length;}}if(idx>-1){classes.splice(idx,1);this.className=classes.join(" ");}return this;
};thingy.hasClass=function(name){return !!this.className.match(new RegExp("\\s*"+name+"\\s*"));};}return thingy;},setMoviePath:function(path){this.moviePath=path;},dispatch:function(id,eventName,args){var client=this.clients[id];if(client){client.receiveEvent(eventName,args);}},register:function(id,client){this.clients[id]=client;},getDOMObjectPosition:function(obj,stopObj){var info={left:0,top:0,width:obj.width?obj.width:obj.offsetWidth,height:obj.height?obj.height:obj.offsetHeight};while(obj&&(obj!=stopObj)){info.left+=obj.offsetLeft;info.top+=obj.offsetTop;obj=obj.offsetParent;}return info;},Client:function(elem){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId="ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);if(elem){this.glue(elem);}}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:"",handCursorEnabled:true,cssEffects:true,handlers:null,glue:function(elem,appendElem,stylesToAdd){var addedStyle,zIndex=99;this.domElement=ZeroClipboard.$(elem);
if(this.domElement.style.zIndex){zIndex=parseInt(this.domElement.style.zIndex,10)+1;}if(typeof(appendElem)=="string"){appendElem=ZeroClipboard.$(appendElem);}else{if(typeof(appendElem)=="undefined"){appendElem=document.getElementsByTagName("body")[0];}}var box=ZeroClipboard.getDOMObjectPosition(this.domElement,appendElem);this.div=document.createElement("div");var style=this.div.style;style.position="absolute";style.left=""+box.left+"px";style.top=""+box.top+"px";style.width=""+box.width+"px";style.height=""+box.height+"px";style.zIndex=zIndex;if(typeof(stylesToAdd)=="object"){for(addedStyle in stylesToAdd){style[addedStyle]=stylesToAdd[addedStyle];}}appendElem.appendChild(this.div);this.div.innerHTML=this.getHTML(box.width,box.height);},getHTML:function(width,height){var html="";var flashvars="id="+this.id+"&width="+width+"&height="+height;if(navigator.userAgent.match(/MSIE/)){var protocol=location.href.match(/^https/i)?"https://":"http://";html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+protocol+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+width+'" height="'+height+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/><param name="wmode" value="transparent"/></object>';
}else{html+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+width+'" height="'+height+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'" wmode="transparent" />';}return html;},hide:function(){if(this.div){this.div.style.left="-2000px";}},show:function(){this.reposition();},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var body=document.getElementsByTagName("body")[0];try{body.removeChild(this.div);}catch(e){}this.domElement=null;this.div=null;}},reposition:function(elem){if(elem){this.domElement=ZeroClipboard.$(elem);if(!this.domElement){this.hide();}}if(this.domElement&&this.div){var box=ZeroClipboard.getDOMObjectPosition(this.domElement);var style=this.div.style;style.left=""+box.left+"px";style.top=""+box.top+"px";
}},setText:function(newText){this.clipText=newText;if(this.ready){this.movie.setText(newText);}},addEventListener:function(eventName,func){eventName=eventName.toString().toLowerCase().replace(/^on/,"");if(!this.handlers[eventName]){this.handlers[eventName]=[];}this.handlers[eventName].push(func);},setHandCursor:function(enabled){this.handCursorEnabled=enabled;if(this.ready){this.movie.setHandCursor(enabled);}},setCSSEffects:function(enabled){this.cssEffects=!!enabled;},receiveEvent:function(eventName,args){var self;eventName=eventName.toString().toLowerCase().replace(/^on/,"");switch(eventName){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){self=this;setTimeout(function(){self.receiveEvent("load",null);},1);return;}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){self=this;setTimeout(function(){self.receiveEvent("load",null);},100);this.ready=true;return;}this.ready=true;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);
break;case"mouseover":if(this.domElement&&this.cssEffects){this.domElement.addClass("hover");if(this.recoverActive){this.domElement.addClass("active");}}break;case"mouseout":if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass("active")){this.domElement.removeClass("active");this.recoverActive=true;}this.domElement.removeClass("hover");}break;case"mousedown":if(this.domElement&&this.cssEffects){this.domElement.addClass("active");}break;case"mouseup":if(this.domElement&&this.cssEffects){this.domElement.removeClass("active");this.recoverActive=false;}break;}if(this.handlers[eventName]){for(var idx=0,len=this.handlers[eventName].length;idx<len;idx++){var func=this.handlers[eventName][idx];if(typeof(func)=="function"){func(this,args);}else{if((typeof(func)=="object")&&(func.length==2)){func[0][func[1]](this,args);}else{if(typeof(func)=="string"){window[func](this,args);}}}}}}};(function($){$.timeago=function(timestamp){if(timestamp instanceof Date){return inWords(timestamp);
}else{if(typeof timestamp==="string"){return inWords($.timeago.parse(timestamp));}else{return inWords($.timeago.datetime(timestamp));}}};var $t=$.timeago;$.extend($.timeago,{settings:{refreshMillis:60000,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"%d seconds",second:"1 second",minute:"1 minute",minutes:"%d minutes",hour:"1 hour",hours:"%d hours",day:"1 day",days:"%d days",month:"1 month",months:"%d months",year:"1 year",years:"%d years",numbers:[]}},inWords:function(distanceMillis){var $l=this.settings.strings;var prefix=$l.prefixAgo;var suffix=$l.suffixAgo;if(this.settings.allowFuture){if(distanceMillis<0){prefix=$l.prefixFromNow;suffix=$l.suffixFromNow;}distanceMillis=Math.abs(distanceMillis);}var seconds=distanceMillis/1000;var minutes=seconds/60;var hours=minutes/60;var days=hours/24;var years=days/365;function substitute(stringOrFunction,number){var string=$.isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction;
var value=($l.numbers&&$l.numbers[number])||number;return string.replace(/%d/i,value);}var words=seconds<1&&substitute($l.second,Math.round(seconds))||seconds<60&&substitute($l.seconds,Math.round(seconds))||seconds<90&&substitute($l.minute,1)||minutes<45&&substitute($l.minutes,Math.round(minutes))||minutes<90&&substitute($l.hour,1)||hours<24&&substitute($l.hours,Math.round(hours))||hours<48&&substitute($l.day,1)||days<30&&substitute($l.days,Math.floor(days))||days<60&&substitute($l.month,1)||days<365&&substitute($l.months,Math.floor(days/30))||years<2&&substitute($l.year,1)||substitute($l.years,Math.floor(years));return $.trim([prefix,words,suffix].join(" "));},parse:function(iso8601){var s=$.trim(iso8601),d;try{d=new Date(s);}catch(x){s=s.replace(/\.\d\d\d+/,"");s=s.replace(/-/,"/").replace(/-/,"/");s=s.replace(/T/," ").replace(/Z/," UTC");s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");d=new Date(s);}return d;},datetime:function(elem){var isTime=$(elem).get(0).tagName.toLowerCase()==="time";
var iso8601=isTime?$(elem).attr("datetime"):$(elem).attr("title");return $t.parse(iso8601);}});$.fn.timeago=function(){var self=this;self.each(refresh);var $s=$t.settings;if($s.refreshMillis>0){setInterval(function(){self.each(refresh);},$s.refreshMillis);}return self;};function refresh(){var data=prepareData(this);if(!isNaN(data.datetime)){$(this).text(inWords(data.datetime));}return this;}function prepareData(element){element=$(element);if(!element.data("timeago")){element.data("timeago",{datetime:$t.datetime(element)});var text=$.trim(element.text());if(text.length>0){element.attr("title",text);}}return element.data("timeago");}function inWords(date){return $t.inWords(distance(date));}function distance(date){return(new Date().getTime()-date.getTime());}document.createElement("abbr");document.createElement("time");}(jQuery));(function($,h,c){var a=$([]),e=$.resize=$.extend($.resize,{}),i,k="setTimeout",j="resize",d=j+"-special-event",b="delay",f="throttleWindow";e[b]=250;e[f]=true;$.event.special[j]={setup:function(){if(!e[f]&&this[k]){return false;
}var l=$(this);a=a.add(l);$.data(this,d,{w:l.width(),h:l.height()});if(a.length===1){g();}},teardown:function(){if(!e[f]&&this[k]){return false;}var l=$(this);a=a.not(l);l.removeData(d);if(!a.length){clearTimeout(i);}},add:function(l){if(!e[f]&&this[k]){return false;}var n;function m(s,o,p){var q=$(this),r=$.data(this,d);r.w=o!==c?o:q.width();r.h=p!==c?p:q.height();n.apply(this,arguments);}if($.isFunction(l)){n=l;return m;}else{n=l.handler;l.handler=m;}}};function g(){i=h[k](function(){a.each(function(){var n=$(this),m=n.width(),l=n.height(),o=$.data(this,d);if(m!==o.w||l!==o.h){n.trigger(j,[o.w=m,o.h=l]);}});g();},e[b]);}})(jQuery,this);
/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license */
/*! NOTE: If you're already including a window.matchMedia polyfill via Modernizr or otherwise, you don't need this part */
window.matchMedia=window.matchMedia||(function(doc,undefined){var bool,docElem=doc.documentElement,refNode=docElem.firstElementChild||docElem.firstChild,fakeBody=doc.createElement("body"),div=doc.createElement("div");
div.id="mq-test-1";div.style.cssText="position:absolute;top:-100em";fakeBody.style.background="none";fakeBody.appendChild(div);return function(q){div.innerHTML='&shy;<style media="'+q+'"> #mq-test-1 { width: 42px; }</style>';docElem.insertBefore(fakeBody,refNode);bool=div.offsetWidth===42;docElem.removeChild(fakeBody);return{matches:bool,media:q};};}(document));
/*! Respond.js v1.1.0: min/max-width media query polyfill. (c) Scott Jehl. MIT/GPLv2 Lic. j.mp/respondjs  */
(function(win){var respond={};win.respond=respond;respond.update=function(){};respond.mediaQueriesSupported=win.matchMedia&&win.matchMedia("only all").matches;if(respond.mediaQueriesSupported){return;}var doc=win.document,docElem=doc.documentElement,mediastyles=[],rules=[],appendedEls=[],parsedSheets={},resizeThrottle=30,head=doc.getElementsByTagName("head")[0]||docElem,base=doc.getElementsByTagName("base")[0],links=head.getElementsByTagName("link"),requestQueue=[],ripCSS=function(){for(var i=0;i<links.length;i++){var sheet=links[i],href=sheet.href,media=sheet.media,isCSS=sheet.rel&&sheet.rel.toLowerCase()==="stylesheet";
if(!!href&&isCSS&&!parsedSheets[href]){if(sheet.styleSheet&&sheet.styleSheet.rawCssText){translate(sheet.styleSheet.rawCssText,href,media);parsedSheets[href]=true;}else{if((!/^([a-zA-Z:]*\/\/)/.test(href)&&!base)||href.replace(RegExp.$1,"").split("/")[0]===win.location.host){requestQueue.push({href:href,media:media});}}}}makeRequests();},makeRequests=function(){if(requestQueue.length){var thisRequest=requestQueue.shift();ajax(thisRequest.href,function(styles){translate(styles,thisRequest.href,thisRequest.media);parsedSheets[thisRequest.href]=true;setTimeout(function(){makeRequests();},0);});}},translate=function(styles,href,media){var qs=styles.match(/@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi),ql=qs&&qs.length||0;href=href.substring(0,href.lastIndexOf("/"));var repUrls=function(css){return css.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,"$1"+href+"$2$3");},useMedia=!ql&&media;if(href.length){href+="/";}if(useMedia){ql=1;}for(var i=0;i<ql;i++){var fullq,thisq,eachq,eql;if(useMedia){fullq=media;
rules.push(repUrls(styles));}else{fullq=qs[i].match(/@media *([^\{]+)\{([\S\s]+?)$/)&&RegExp.$1;rules.push(RegExp.$2&&repUrls(RegExp.$2));}eachq=fullq.split(",");eql=eachq.length;for(var j=0;j<eql;j++){thisq=eachq[j];mediastyles.push({media:thisq.split("(")[0].match(/(only\s+)?([a-zA-Z]+)\s?/)&&RegExp.$2||"all",rules:rules.length-1,hasquery:thisq.indexOf("(")>-1,minw:thisq.match(/\(min\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:thisq.match(/\(max\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||"")});}}applyMedia();},lastCall,resizeDefer,getEmValue=function(){var ret,div=doc.createElement("div"),body=doc.body,fakeUsed=false;div.style.cssText="position:absolute;font-size:1em;width:1em";if(!body){body=fakeUsed=doc.createElement("body");body.style.background="none";}body.appendChild(div);docElem.insertBefore(body,docElem.firstChild);ret=div.offsetWidth;if(fakeUsed){docElem.removeChild(body);}else{body.removeChild(div);
}ret=eminpx=parseFloat(ret);return ret;},eminpx,applyMedia=function(fromResize){var name="clientWidth",docElemProp=docElem[name],currWidth=doc.compatMode==="CSS1Compat"&&docElemProp||doc.body[name]||docElemProp,styleBlocks={},lastLink=links[links.length-1],now=(new Date()).getTime();if(fromResize&&lastCall&&now-lastCall<resizeThrottle){clearTimeout(resizeDefer);resizeDefer=setTimeout(applyMedia,resizeThrottle);return;}else{lastCall=now;}for(var i in mediastyles){if(mediastyles.hasOwnProperty(i)){var thisstyle=mediastyles[i],min=thisstyle.minw,max=thisstyle.maxw,minnull=min===null,maxnull=max===null,em="em";if(!!min){min=parseFloat(min)*(min.indexOf(em)>-1?(eminpx||getEmValue()):1);}if(!!max){max=parseFloat(max)*(max.indexOf(em)>-1?(eminpx||getEmValue()):1);}if(!thisstyle.hasquery||(!minnull||!maxnull)&&(minnull||currWidth>=min)&&(maxnull||currWidth<=max)){if(!styleBlocks[thisstyle.media]){styleBlocks[thisstyle.media]=[];}styleBlocks[thisstyle.media].push(rules[thisstyle.rules]);}}}for(var j in appendedEls){if(appendedEls.hasOwnProperty(j)){if(appendedEls[j]&&appendedEls[j].parentNode===head){head.removeChild(appendedEls[j]);
}}}for(var k in styleBlocks){if(styleBlocks.hasOwnProperty(k)){var ss=doc.createElement("style"),css=styleBlocks[k].join("\n");ss.type="text/css";ss.media=k;head.insertBefore(ss,lastLink.nextSibling);if(ss.styleSheet){ss.styleSheet.cssText=css;}else{ss.appendChild(doc.createTextNode(css));}appendedEls.push(ss);}}},ajax=function(url,callback){var req=xmlHttp();if(!req){return;}req.open("GET",url,true);req.onreadystatechange=function(){if(req.readyState!==4||req.status!==200&&req.status!==304){return;}callback(req.responseText);};if(req.readyState===4){return;}req.send(null);},xmlHttp=(function(){var xmlhttpmethod=false;try{xmlhttpmethod=new win.XMLHttpRequest();}catch(e){xmlhttpmethod=new win.ActiveXObject("Microsoft.XMLHTTP");}return function(){return xmlhttpmethod;};})();ripCSS();respond.update=ripCSS;function callMedia(){applyMedia(true);}if(win.addEventListener){win.addEventListener("resize",callMedia,false);}else{if(win.attachEvent){win.attachEvent("onresize",callMedia);}}})(this);function Swipe(container,options){var noop=function(){};
var offloadFn=function(fn){setTimeout(fn||noop,0);};var browser={addEventListener:!!window.addEventListener,touch:("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch,transitions:(function(temp){var props=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var i in props){if(temp.style[props[i]]!==undefined){return true;}}return false;})(document.createElement("swipe"))};if(!container){return;}var element=container.children[0];var slides,slidePos,width,length;options=options||{};var index=parseInt(options.startSlide,10)||0;var speed=options.speed||300;options.continuous=options.continuous!==undefined?options.continuous:true;function setup(){slides=element.children;length=slides.length;if(slides.length<2){options.continuous=false;}if(browser.transitions&&options.continuous&&slides.length<3){element.appendChild(slides[0].cloneNode(true));element.appendChild(element.children[1].cloneNode(true));slides=element.children;}slidePos=new Array(slides.length);
width=container.getBoundingClientRect().width||container.offsetWidth;element.style.width=(slides.length*width)+"px";var pos=slides.length;while(pos--){var slide=slides[pos];slide.style.width=width+"px";slide.setAttribute("data-index",pos);if(browser.transitions){slide.style.left=(pos*-width)+"px";move(pos,index>pos?-width:(index<pos?width:0),0);}}if(options.continuous&&browser.transitions){move(circle(index-1),-width,0);move(circle(index+1),width,0);}if(!browser.transitions){element.style.left=(index*-width)+"px";}container.style.visibility="visible";}function prev(){if(options.continuous){slide(index-1);}else{if(index){slide(index-1);}}}function next(){if(options.continuous){slide(index+1);}else{if(index<slides.length-1){slide(index+1);}}}function circle(index){return(slides.length+(index%slides.length))%slides.length;}function slide(to,slideSpeed){if(index==to){return;}if(browser.transitions){var direction=Math.abs(index-to)/(index-to);if(options.continuous){var natural_direction=direction;
direction=-slidePos[circle(to)]/width;if(direction!==natural_direction){to=-direction*slides.length+to;}}var diff=Math.abs(index-to)-1;while(diff--){move(circle((to>index?to:index)-diff-1),width*direction,0);}to=circle(to);move(index,width*direction,slideSpeed||speed);move(to,0,slideSpeed||speed);if(options.continuous){move(circle(to-direction),-(width*direction),0);}}else{to=circle(to);animate(index*-width,to*-width,slideSpeed||speed);}index=to;offloadFn(options.callback&&options.callback(index,slides[index]));}function move(index,dist,speed){translate(index,dist,speed);slidePos[index]=dist;}function translate(index,dist,speed){var slide=slides[index];var style=slide&&slide.style;if(!style){return;}style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=speed+"ms";style.webkitTransform="translate("+dist+"px,0)"+"translateZ(0)";style.msTransform=style.MozTransform=style.OTransform="translateX("+dist+"px)";}function animate(from,to,speed){if(!speed){element.style.left=to+"px";
return;}var start=+new Date;var timer=setInterval(function(){var timeElap=+new Date-start;if(timeElap>speed){element.style.left=to+"px";if(delay){begin();}options.transitionEnd&&options.transitionEnd.call(event,index,slides[index]);clearInterval(timer);return;}element.style.left=(((to-from)*(Math.floor((timeElap/speed)*100)/100))+from)+"px";},4);}var delay=options.auto||0;var interval;function begin(){interval=setTimeout(next,delay);}function stop(){delay=0;clearTimeout(interval);}var start={};var delta={};var isScrolling;var events={handleEvent:function(event){switch(event.type){case"touchstart":this.start(event);break;case"touchmove":this.move(event);break;case"touchend":offloadFn(this.end(event));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":offloadFn(this.transitionEnd(event));break;case"resize":offloadFn(setup.call());break;}if(options.stopPropagation){event.stopPropagation();}},start:function(event){var touches=event.touches[0];
start={x:touches.pageX,y:touches.pageY,time:+new Date};isScrolling=undefined;delta={};element.addEventListener("touchmove",this,false);element.addEventListener("touchend",this,false);},move:function(event){if(event.touches.length>1||event.scale&&event.scale!==1){return;}if(options.disableScroll){event.preventDefault();}var touches=event.touches[0];delta={x:touches.pageX-start.x,y:touches.pageY-start.y};if(typeof isScrolling=="undefined"){isScrolling=!!(isScrolling||Math.abs(delta.x)<Math.abs(delta.y));}if(!isScrolling){event.preventDefault();stop();if(options.continuous){translate(circle(index-1),delta.x+slidePos[circle(index-1)],0);translate(index,delta.x+slidePos[index],0);translate(circle(index+1),delta.x+slidePos[circle(index+1)],0);}else{delta.x=delta.x/((!index&&delta.x>0||index==slides.length-1&&delta.x<0)?(Math.abs(delta.x)/width+1):1);translate(index-1,delta.x+slidePos[index-1],0);translate(index,delta.x+slidePos[index],0);translate(index+1,delta.x+slidePos[index+1],0);}}},end:function(event){var duration=+new Date-start.time;
var isValidSlide=Number(duration)<250&&Math.abs(delta.x)>20||Math.abs(delta.x)>width/2;var isPastBounds=!index&&delta.x>0||index==slides.length-1&&delta.x<0;if(options.continuous){isPastBounds=false;}var direction=delta.x<0;if(!isScrolling){if(isValidSlide&&!isPastBounds){if(direction){if(options.continuous){move(circle(index-1),-width,0);move(circle(index+2),width,0);}else{move(index-1,-width,0);}move(index,slidePos[index]-width,speed);move(circle(index+1),slidePos[circle(index+1)]-width,speed);index=circle(index+1);}else{if(options.continuous){move(circle(index+1),width,0);move(circle(index-2),-width,0);}else{move(index+1,width,0);}move(index,slidePos[index]+width,speed);move(circle(index-1),slidePos[circle(index-1)]+width,speed);index=circle(index-1);}options.callback&&options.callback(index,slides[index]);}else{if(options.continuous){move(circle(index-1),-width,speed);move(index,0,speed);move(circle(index+1),width,speed);}else{move(index-1,-width,speed);move(index,0,speed);move(index+1,width,speed);
}}}element.removeEventListener("touchmove",events,false);element.removeEventListener("touchend",events,false);},transitionEnd:function(event){if(parseInt(event.target.getAttribute("data-index"),10)==index){if(delay){begin();}options.transitionEnd&&options.transitionEnd.call(event,index,slides[index]);}}};setup();if(delay){begin();}if(browser.addEventListener){if(browser.touch){element.addEventListener("touchstart",events,false);}if(browser.transitions){element.addEventListener("webkitTransitionEnd",events,false);element.addEventListener("msTransitionEnd",events,false);element.addEventListener("oTransitionEnd",events,false);element.addEventListener("otransitionend",events,false);element.addEventListener("transitionend",events,false);}window.addEventListener("resize",events,false);}else{window.onresize=function(){setup();};}return{setup:function(){setup();},slide:function(to,speed){stop();slide(to,speed);},prev:function(){stop();prev();},next:function(){stop();next();},getPos:function(){return index;
},getNumSlides:function(){return length;},kill:function(){stop();element.style.width="auto";element.style.left=0;var pos=slides.length;while(pos--){var slide=slides[pos];slide.style.width="100%";slide.style.left=0;if(browser.transitions){translate(pos,0,0);}}if(browser.addEventListener){element.removeEventListener("touchstart",events,false);element.removeEventListener("webkitTransitionEnd",events,false);element.removeEventListener("msTransitionEnd",events,false);element.removeEventListener("oTransitionEnd",events,false);element.removeEventListener("otransitionend",events,false);element.removeEventListener("transitionend",events,false);window.removeEventListener("resize",events,false);}else{window.onresize=null;}}};}if(window.jQuery||window.Zepto){(function($){$.fn.Swipe=function(params){return this.each(function(){$(this).data("Swipe",new Swipe($(this)[0],params));});};})(window.jQuery||window.Zepto);}